{% extends "layout/layout.html" %}

{% block page_title %}Leads{% endblock  %}


{% block page_body %}

{% load static %}
{% load poll_extras %}


<div class="w-full h-full py-1 px-4">
    <div class="w-full h-full p-1 rounded-3xl bg-gray-100">
        
        <div class="h-auto p-1 flex justify-between">

            <div class="h-full w-[calc(100%)] px-4 flex">
                <div class="h-6 w-16 relative rounded-lg text-xs flex justify-center items-center font-bold cursor-pointer">
                    {% comment %} Filter By {% endcomment %}
                    <div class="btn btn-warning btn-xs filter_by_btn">Filter By</div>
                    <div class="absolute top-0 left-[100%] w-[600px] h-96 bg-slate-100 rounded filter_option_dv z-10 hidden border border-solid border-slate-400 p-2 flex">

                        <div class="w-[35%] h-full border-r">
                            <div class="h-[calc(100%-50px)] overflow-y-scroll">
                                <ul class="">
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="lead_status" >Lead Status</li>
                                    {% comment %} <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="service_required" >Service Required</li> {% endcomment %}
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="associate" >Associate</li>
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="lead_assigned" >Lead Assigned</li>
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="segment" >Segment</li>
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="service" >Service</li>
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="marketplace" >Marketplace</li>
                                    <li class="filter_by_opt h-10 px-2 flex items-center duration-200 " data-name="program" >Program</li>
                                </ul>
                            </div>
                            <div class="flex justify-center items-center w-full h-[50px]">
                                <button class="btn btn-xs text-white btn-success submit">Submit</button>
                            </div>
                        </div>

                        
                        <div class="p-2 flex flex-col w-[65%] h-full justify-center items-center">
                            <div class="selcont lead_status_dv w-full h-full hidden flex flex-col items-start" data-name="lead_status">

                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with request.GET.lead_status|default:"all" as parameter_value %} 
                                        {% for ld in lead_status %}
                                        <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                            <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                <input type="checkbox" id="{{ld}}" data-parent='lead_status' data-id="{{ld}}" data-name="{{ld}}" class='{{ld}}_checkbox checkbox_inp'>
                                            </div>
                                            <label class="w-[calc(100%-20px)] capitalize" for="{{ld}}">{{ld|customreplacespace:'_'}}</label>
                                        </li>
                                        {% endfor %}
                                        {% endwith %}
                                        
                                    </ul>
                                </div>
                            </div>
            
                            <div class="selcont capitalize rounded-md h-full w-full lead_filter associate text-xs hidden" data-name="associate">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with reporting_associates=request.user|getReportingAssociate %}
                                        {% comment %} {% with request.GET.lead_status|default:"all" as parameter_value %} {% endcomment %}
                                            {% for s in reporting_associates %}
                                                <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                                    <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                        <input type="checkbox" id="associate_{{s.id}}" data-parent='associate' data-id="{{s.id}}" data-name={{s.id}} class='{{s.id}}_checkbox checkbox_inp'>
                                                    </div>
                                                    <label class="w-[calc(100%-20px)] capitalize" for="associate_{{s.id}}">{{s.name}}</label>
                                                </li>
                                            {% endfor %}
                                        {% endwith %}
                                    </ul>
                                </div>
                            </div>

                            <div class="selcont capitalize rounded-md h-full w-full lead_filter lead_assigned text-xs hidden" data-name="lead_assigned">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% comment %} {% with reporting_associates=request.user.reporting_manager|getReportingAssociate %}     {% endcomment %}
                                        {% comment %} {% with request.GET.lead_status|default:"all" as parameter_value %} {% endcomment %}
                                            {% comment %} {% for s in reporting_associates %} {% endcomment %}
                                                <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                                    <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                        <input type="checkbox" id="assigned" data-parent='lead_assigned' data-id="assigned" data-name="assigned" class='assigned_checkbox checkbox_inp'>
                                                    </div>
                                                    <label class="w-[calc(100%-20px)] capitalize" for="assigned">Assigned</label>
                                                </li>
                                                <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                                    <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                        <input type="checkbox" id="unassigned" data-parent='lead_assigned' data-id="unassigned" data-name="unassigned" class='unassigned_checkbox checkbox_inp'>
                                                    </div>
                                                    <label class="w-[calc(100%-20px)] capitalize" for="unassigned">Unassigned</label>
                                                </li>
                                            {% comment %} {% endfor %} {% endcomment %}
                                        {% comment %} {% endwith %} {% endcomment %}
                                    </ul>
                                </div>
                            </div>

                            <div class="selcont segment_dv hidden h-full w-full flex flex-col items-start" data-name="segment">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with request.GET.lead_status|default:"all" as parameter_value %}
                                        {% for s in dropdown_data.0.segment %}
                                        <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                            <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                <input type="checkbox" id="segment_{{s.id}}" data-parent='segment' data-id={{s.id}} data-name={{s.id}} class='{{s}}_checkbox checkbox_inp'>
                                            </div>
                                            <label class="w-[calc(100%-20px)] capitalize" for="segment_{{s.id}}">{{s}}</label>
                                        </li>
                                        {% endfor %}
                                        {% endwith %}
                                    </ul>
                                </div>
                            </div>
                            <div class="selcont service_dv hidden h-full w-full flex flex-col items-start" data-name="service">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with request.GET.lead_status|default:"all" as parameter_value %}
                                        {% for s in dropdown_data.0.service %}
                                        <li class="flex w-full h-auto items-center hover:bg-white py-1">
                                            <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                <input type="checkbox" id="service_{{s.id}}" data-parent='service' data-id={{s.id}} data-name={{s.id}} class='{{s}}_checkbox checkbox_inp'>
                                            </div>
                                            <label class="w-[calc(100%-20px)] capitalize" for="service_{{s.id}}">{{s}}<span class="font-normal text-[9px]"> - {{s.segment}}</span></label>
                                        </li>
                                        {% endfor %}
                                        {% endwith %}
                                    </ul>
                                </div>
                            </div>
                            <div class="selcont marketplace_dv hidden h-full w-full flex flex-col items-start" data-name="marketplace">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with request.GET.lead_status|default:"all" as parameter_value %}
                                        {% for s in dropdown_data.0.marketplace %}
                                        <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                            <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                <input type="checkbox" id="marketplace_{{s.id}}" data-parent='marketplace' data-id={{s.id}} data-name={{s.id}} class='{{s}}_checkbox checkbox_inp'>
                                            </div>
                                            <label class="w-[calc(100%-20px)] capitalize" for="marketplace_{{s.id}}">{{s}}<span class="font-normal text-[9px]"> - {{s.service.segment}} | {{s.service}}</span></label>
                                        </li>
                                        {% endfor %}
                                        {% endwith %}
                                    </ul>
                                </div>
                            </div>
                            <div class="selcont program_dv hidden h-full w-full flex flex-col items-start" data-name="program">
                                <div class="w-full h-full overflow-y-scroll">
                                    <ul class="h-full w-full">
                                        {% with request.GET.lead_status|default:"all" as parameter_value %}
                                        {% for s in dropdown_data.0.program %}
                                        <li class="flex w-full h-auto items-center hover:bg-white p-1">
                                            <div class="w-[20px] h-[20px] ml-2 flex items-center">
                                                <input type="checkbox" id="program_{{s.id}}" data-parent='program' data-id={{s.id}} data-name={{s.id}} class='{{s}}_checkbox checkbox_inp'>
                                            </div>
                                            <label class="w-[calc(100%-20px)] capitalize" for="program_{{s.id}}">{{s}}<span class="font-normal text-[9px]"> - {{s.marketplace.service.segment}} | {{s.marketplace.service}} | {{s.segment}}</span></label>
                                        </li>
                                        {% endfor %}
                                        {% endwith %}
                                    </ul>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                {% if 'lead_status' in request.GET or 'associate' in request.GET or 'segment' in request.GET or 'service' in request.GET or 'marketplace' in request.GET or 'program' in request.GET %}

                    <div class="w-[calc(100%-64px)] h-8 flex text-xs overflow-y-scroll mx-1 rounded-xl border flex items-center">
                    {% comment %} <div class="flex w-full"> {% endcomment %}

            
                        <div class="p-1 cursor-pointer bg-red-500 rounded-lg ml-1 text-white clear_all_filter">Clear All</div>
                        {% for k,v in request.GET.items %}
                            {% for value in v|stringToList  %}
                                <div class="h-6 text-nowrap mx-1 flex items-center bg-white rounded-xl py-1 text-[11px] overflow-hidden">
                                    <div class="flex items-center w-auto p-2">
                                        <span class="font-medium w-auto capitalize">{{ k|customreplacespace:'_' }}</span>
                                        <span>: </span>
                                        
                                        {% if k == 'associate' %}  
                                            {% with associate=value|getAssociate %}
                                                <span class="w-auto capitalize ml-1"> {{ associate.name }}</span>
                                            {% endwith %}   
                                        {% elif k == 'segment' %}
                                            {% with segment=value|getSegment %}
                                                <span class="w-aussto capitalize ml-1"> {{ segment.segment }}</span>
                                            {% endwith %}
                                        {% elif k == 'service' %}
                                            {% with service=value|getService %}
                                                <span class="w-aussto capitalize ml-1"> {{ service.service }}</span>
                                            {% endwith %}
                                        {% elif k == 'marketplace' %}
                                            {% with marketplace=value|getMarketplace %}
                                                <span class="w-aussto capitalize ml-1"> {{ marketplace.marketplace }}</span>
                                            {% endwith %}
                                        {% elif k == 'program' %}
                                            {% with program=value|getProgram %}
                                                <span class="w-aussto capitalize ml-1"> {{ program.program }}</span>
                                            {% endwith %}
                                        {% else %}
                                            <span class="w-aussto capitalize ml-1"> {{ value|customreplacespace:'_' }}</span>
                                        {% endif %}

                                    </div>
                                    <div class="h-6 w-6 clear_filter flex items-center justify-center border-l cursor-pointer bg-red-500 p-1"  >
                                        <img data-parent="{{k}}" data-id="{{value}}" src="{% static "assets/images/close_button.png" %}" >
                                    </div>
                                </div>       
                            {% endfor %}
                        {% endfor %}


                    {% comment %} </div> {% endcomment %}
                    </div>
                {% endif %}


                
                {% comment %} <div role="tablist" class="tabs tabs-boxed tabs-xs"> {% endcomment %}
                
                <script>

                    function searchHighlighter(){
                        const data = {};            
                        {% for k,v in request.GET.items  %}
                            data['{{k}}'] = '{{v}}'.split('%2C')
                        {% endfor %}

                        const inp = document.querySelectorAll('.checkbox_inp');
                        inp.forEach(e=>{
                            // console.log (data[e.getAttribute('data-parent')], e.getAttribute('data-id') )
                            if ( data[e.getAttribute('data-parent')] !== undefined && data[e.getAttribute('data-parent')].includes(e.getAttribute('data-id'))){
                                e.checked = true
                            } else {
                                e.checked = false
                            }
                        })

                        
                        const clear_filter = document.querySelectorAll('.clear_filter');
                        clear_filter.forEach(e=>{
                            e.onclick = function (e){
                                let params = {};
                                let url = new URLSearchParams(window.location.search);
                                url.forEach((v,k)=>{
                                    let paramData = decodeURIComponent(v).split(',');
                                    // console.log(k, paramData.indexOf(e.target.getAttribute('data-id')))
                                    
                                    if (k === e.target.getAttribute('data-parent') && paramData.indexOf(e.target.getAttribute('data-id')) !== -1){
                                        paramData.splice(paramData.indexOf(e.target.getAttribute('data-id')), 1)
                                    }


                                    if (paramData.length > 0){
                                        params[k] =  paramData
                                    }
                                })


                                for (let k in params ){
                                    params[k] =  encodeURIComponent(params[k]);
                                } 
    
                                url = new URL(window.location.origin+window.location.pathname)
                                Object.keys(params).forEach(key=> url.searchParams.append(key, params[key]))
                                window.location.href = url.toString()

                            }
                        })

                        const clear_all_filter = document.querySelector('.clear_all_filter');
                        if (clear_all_filter){   
                            clear_all_filter.onclick = function(e){
                                window.location.href = window.location.origin+window.location.pathname
                            }
                        }
                        

                    } searchHighlighter()


                    console.log('GET', '{{request.GET.lead_assigned}}'.split('%2C') )
                    
                    var selected_programs_list = [];
                    var selectedSegment;
                    var selectedService;
                    var selectedMarketplace;
                    var selectedProgram;

                    const filter_by_btn = document.querySelector('.filter_by_btn');
                    const filter_option_dv = document.querySelector('.filter_option_dv');
                    
                    const filter_by_opt = document.querySelectorAll('.filter_by_opt');

                    filter_by_btn.addEventListener('click', ()=>{
                        if (filter_option_dv.classList.value.includes('hidden')){filter_option_dv.classList.remove('hidden')} else {filter_option_dv.classList.add('hidden')}
                    })

                    function filterOptHideAll(){
                        const selcont = document.querySelectorAll('.selcont');
                        selcont.forEach(e=>{if (! e.classList.value.includes('hidden') ){e.classList.add('hidden')} })
                        return selcont;
                    }

                    filter_by_opt.forEach((e,i,a)=>{
                        e.addEventListener('click', ()=>{

                            a.forEach(e=>{e.classList.remove('bg-white')})
                            e.classList.add('bg-white')
                            // console.log('e', e)
                            const lead_status_dv = document.querySelector('.lead_status_dv')
                            const service_required = document.querySelector('.service_required')
                            const lead_assigned = document.querySelector('.lead_assigned')

                            const contn = filterOptHideAll();
                            contn[i].classList.remove('hidden')
                            // console.log('contn',contn);

                            // if (e.getAttribute('data-name') === 'lead_status') {
                                // lead_status_dv.classList.remove('hidden')
                                // if (!service_required.classList.value.includes('hidden')){
                                //     service_required.classList.add('hidden')
                                // }
                                // if (!lead_assigned.classList.value.includes('hidden')){
                                //     lead_assigned.classList.add('hidden')
                                // }
                            // } else if (e.getAttribute('data-name') === 'service_required'){
                                
                                // service_required.classList.remove('hidden')

                                // if (!lead_status_dv.classList.value.includes('hidden')){
                                //     lead_status_dv.classList.add('hidden')
                                // }
                                // 
                                // 
                                // if (!lead_assigned.classList.value.includes('hidden')){
                                //     lead_assigned.classList.add('hidden')
                                // }

                            // } else if (e.getAttribute('data-name') === 'lead_assigned'){
                                // if (!lead_status_dv.classList.value.includes('hidden')){
                                //     lead_status_dv.classList.add('hidden')
                                // }
                                // if (!service_required.classList.value.includes('hidden')){
                                //     service_required.classList.add('hidden')
                                // }
                                // lead_assigned.classList.remove('hidden')
                            // }
                            // lead_filter
                            // filter_option_dv.classList.add('hidden');
                        
                        })

                        document.querySelector('.submit').onclick = function (){
                            let data = {}
                            document.querySelectorAll('.selcont').forEach(e=>{
                                let mainData = Array.from(e.querySelectorAll('.checkbox_inp')).filter(e=>e.checked).map(e=>e.getAttribute('data-name'));
                                if (mainData.length > 0){
                                    data[e.getAttribute('data-name')] =  encodeURIComponent(mainData);
                                }
                            })

                            let url = new URL(window.location.origin+window.location.pathname)
                            Object.keys(data).forEach(key=> url.searchParams.append(key, data[key]))
                            window.location.href = url.toString()

                            // const lead_status = document.querySelector('.lead_status');
                            // lead_status.addEventListener('change',()=>{

                                    // let link = addParamsToLink(window.location.href, 'lead_status', lead_status.value)
                            //     window.location.href = link
                            // })
                        } 

                    })


                    function addParamsToLink(link, key, value){
                        let url = new URL(link)
                        url.searchParams.set(key,value)
                        return url.toString()
                    }



                    function highlighter(data, target){
                        data.forEach(e=>{
                            e.parentElement.classList.remove('bg-slate-400')
                        })
                        target.parentElement.classList.add('bg-slate-400')
                    }

                    function defineContainers(){
                        const segment_container = document.querySelector('.segment_container');
                        const service_container = document.querySelector('.service_container');
                        const marketplace_container = document.querySelector('.marketplace_container');
                        const program_container = document.querySelector('.program_container');
                        const commercial_main_dv = document.querySelector('.commercial_main_dv');
                
                        return { 'segment': segment_container, 'service': service_container, 'marketplace': marketplace_container, 'program': program_container, 'commercial_main_dv': commercial_main_dv }
                    }


                    function selectedProgramsViewFunc(program_list){

                        const selected_program_view_dv = document.querySelector('.selected_program_view_dv');
                        if (program_list.length > 0){
                            selected_program_view_dv.classList.remove('hidden')
                        } else {
                            selected_program_view_dv.classList.add('hidden')
                        }
                
                        const selected_programs_view = document.querySelector('.selected_programs_view');
                        main_dropdown_data.forEach(e=>{
                            if (e.table === 'program'){
                                e.value.forEach(e=>{
                                    if (program_list.includes(e.program.id)){
                                        // console.log(e.program.id)
                                        selected_programs_view.innerHTML += `
                                            <li class="h-6 w-full flex items-center my-1">
                                                <div class="archive_user_program w-6 h-full p-1 flex justify-center items-center cursor-pointer bg-red-600 rounded-l-lg" data-id="${e.program.id}" onclick="rPF(event)" ><img src="/static/assets/images/close_button.png"></div>
                                                <div class="w-[calc(100%-24px)] h-full bg-white p-1 rounded-r-lg text-nowrap">${e.segment.value} > ${e.service.value} > ${e.marketplace.value} > ${e.program.value}</div>
                                            </li>
                                            `
                                    }
                                })
                            }
                        })
                    }
                
                    function clearSelectedProgram(){
                        selected_programs_list = [];
                        document.querySelector('.selected_program_view_dv').classList.add('hidden');
                        document.querySelector('.selected_programs_view').innerHTML='';
                        console.log(selected_programs_list);
                    }
                

                


                </script>
                {% comment %} </div> {% endcomment %}
            </div>

            {% comment %} {% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}
                <div class="h-full w-72 px-4">
                    <div role="tablist" class="tabs tabs-boxed tabs-xs">
                        {% with request.GET.type as parameter_value %}
                            <a href="?type=active{% if dict_length > 0%}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{k}}={{v}}{% endif %}{% endfor %}{% endif %}" role="tab" class="tab {% if not parameter_value or parameter_value == 'active' %}tab-active{% endif %}">Active</a>
                            <a href="?type=archive{% if dict_length > 0%}{% for k,v in request.GET.items %}{% if k != 'page' %}&{{k}}={{v}}{% endif %}{% endfor %}{% endif %}" role="tab" class="tab {% if parameter_value == 'archive' %}tab-active{% endif %}" role="tab" class="tab">Archive</a>
                        {% endwith %}
                    </div>
                </div>
            {% endif %} {% endcomment %}
        </div>

        <div class="w-full h-[calc(100%-100px)] flex flex-col overflow-scroll p-2">
            <div class="overflow-x-auto">
                <table class="table">
                  <!-- head -->
                  <thead>
                    {% if data != 'no data' %}
                          <tr>
                            <th class="px-[3px] py-1"><input class="bulk_select_main" type="checkbox"></th>
                            <th class="px-[3px] py-1 flex justify-center"><img class="w-6 h-6" src="{% static "assets/images/table_hot_lead.png" %}"></th>
                            {% comment %} {% if  %} {% endcomment %}
                                {% comment %} <th class="px-[3px] py-1">Client ID</th> {% endcomment %}
                            
                            {% comment %} {% if request.user|role_validity:'business_development_associate' or request.user|role_validity:'business_development_team_lead' or request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %} {% endcomment %}
                                {% comment %} <th class=""><img class="w-[50px]" src="{% static "assets/images/table_hot_lead.png" %}"></th> {% endcomment %}
                                {% comment %} <th><input class="bulk_select_main" type="checkbox"></th> {% endcomment %}
                                <th class="px-[3px] py-1">Lead ID</th>
                            {% comment %} {% endif %} {% endcomment %}

                            <th class="px-[3px] py-1" >Client Name</th>
                            <th class="px-[3px] py-1">Contact Number</th>
                            <th class="px-[3px] py-1">Email</th>

                            {% comment %} {% if  %} {% endcomment %}
                                {% comment %} <th class="px-[3px] py-1">Upload Date</th> {% endcomment %}
                                {% comment %} <th class="px-[3px] py-1">Deadline</th> {% endcomment %}
                                {% comment %} <th class="px-[3px] py-1">Action</th> {% endcomment %}
                            {% comment %} {% if request.user|role_validity:'business_development_associate' or request.user|role_validity:'business_development_team_lead' or request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %} {% endcomment %}

                                <th class="px-[3px] py-1">Marketplace</th>
                                <th class="px-[3px] py-1">Service</th>
                                <th class="px-[3px] py-1">Associate</th>
                                <th class="px-[3px] py-1">Status</th>
                                {% comment %} <th>Deadline</th> {% endcomment %}
                            {% comment %} {% endif %} {% endcomment %}
                            
                            <th>Action</th>

                          </tr>  
                        {% else %}
                            <div class="h-12 flex justify-center items-center bg-gray-200">no data</div>
                    {% endif %}
                  </thead>
                  <tbody class="main_table text-xs">

                    {% if data != None %}
                        {% with request.GET.type|default:'commercial' as parameter_value %}
                            {% for d in data %}

                                {% with status=d.lead_id|getStatus deadline=d.created_date|getDeadline %}
                                    <tr class="border-b border-slate-200 shadow-sm hover:shadow-md {% if status == 'yet_to_contact' %}{% if deadline < 0 %}bg-red-800 text-white{% elif deadline <= 1 %}bg-red-600 text-white{% endif %}{% endif %} rounded-xl">
                                        <td class="px-[3px] py-1 capitalize"><input class="bulk_select" type="checkbox" data-lead-id="{{d.lead_id}}" ></td>
                                        <td class="capitalize">{% if d.hot_lead %}<div class="h-2 w-2 rounded-full bg-yellow-600"></div>{% endif %}</td>
                                        <td class="px-[3px] py-1 capitalize">{{d.lead_id}}</td>
                                        <td class="px-[3px] py-1 capitalize">{{d.client_name}}</td>
                                        <td class="px-[3px] py-1 capitalize">{{d.contact_number}}</td>
                                        <td class="px-[3px] py-1 capitalize">{{d.email_id}}</td>    
                                        <td class="px-[3px] py-1 capitalize">{{d.program.marketplace.marketplace}}</td>
                                        <td class="px-[3px] py-1 capitalize">{{d.program.marketplace.service.service}}</td>
                                        <td class="px-[3px] py-1 capitalize">{% if d.associate %}{{d.associate.name}}{% else %}-{% endif %}</td>
                                        <td class="px-[3px] py-1 capitalize">{{status|customreplacespace:'_'}}</td>
                                        <td class="px-[3px] py-1">
                                            <div class="w-full h-full flex">
                                                <div data-lead-id="{{d.lead_id}}"
                                                    data-client-id="{{d.client_id}}"
                                                    data-request-id="{{d.request_id}}"
                                                    data-provider-id="{{d.provider_id}}"
                                                    data-requester-id="{{d.requester_id}}"
                                                    data-client-name="{{d.client_name}}"
                                                    data-email-id="{{d.email_id}}"
                                                    data-contact-number="{{d.contact_number}}"
                                                    data-requester-location="{{d.requester_location}}"
                                                    data-business-name="{{d.business_name}}"
                                                    data-requester-sell-in-country="{{d.requester_sell_in_country}}"
                                                    data-gst="{{d.gst}}"
                                                    data-service-request-type="{{d.service_request_type}}"
                                                    data-upload-date="{{d.upload_date.year}}-{{d.upload_date.month}}-{{d.upload_date.day}}"
                                                    data-seller-address="{{d.seller_address}}"
                                                    data-lead-owner-id="{{d.lead_owner.id}}"
                                                    data-lead-owner="{{d.lead_owner.name}}"
                                                    data-client-turnover-id="{{d.client_turnover.id}}"
                                                    data-client-turnover="{{d.client_turnover}}"
                                                    data-status="{{status}}"
                                                    data-program-id="{{d.program.id}}"
                                                    data-program="{{d.program.program}}"
                                                    data-marketplace-id="{{d.program.marketplace.id}}"
                                                    data-marketplace="{{d.program.marketplace.marketplace}}"
                                                    data-service-id="{{d.program.marketplace.service.id}}"
                                                    data-service="{{d.program.marketplace.service.service}}"
                                                    data-segment-id="{{d.program.marketplace.service.segment.id}}"
                                                    data-segment="{{d.program.marketplace.service.segment.segment}}"
                                                    data-payment-model-id="{{d.program.payment_model.id}}"
                                                    data-payment-model="{{d.program.payment_model}}"
                                                    data-payment-terms-id="{{d.program.payment_terms.id}}"
                                                    data-payment-terms="{{d.program.payment_terms}}"
                                                    data-mou-required="{{d.program.mou_required}}"
                                                    data-paid-by-id="{{d.program.paid_by.id}}"
                                                    data-paid-by="{{d.program.paid_by}}"
                                                    data-comments="{{d.program.comments}}"
                                                    data-segment="{% for d in d.service_category.all %}{% if d.commercial_approval != None %}{% if d.commercial_approval.approval_type.title == parameter_value %}{{d.service.segment.id}}{% endif %}{% endif %}{% endfor %}"
                                                    data-associate-id="{% for d in d.service_category.all %}{% if d.commercial_approval != None %}{% if d.commercial_approval.approval_type.title == parameter_value %}{{d.associate.id}}{% endif %}{% endif %}{% endfor %}"
                                                    data-associate="{% for d in d.service_category.all %}{% if d.commercial_approval != None %}{% if d.commercial_approval.approval_type.title == parameter_value %}{{d.associate.name}}{% endif %}{% endif %}{% endfor %}"
                                                    data-business-category="{{d.business_category}}"
                                                    data-business-category-id="{{d.business_category.id}}"
                                                    data-hot-lead={% if d.data %}true{% else %}false{% endif %}
                                                
                                                    data-tip="View/Edit"
                                                    class='view_edit tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-green-600 rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_view_white.png" %}">
                                                </div>
                                                <div data-lead-id="{{d.lead_id}}"
                                                    data-client-id="{{d.client_id}}"
                                                    data-client-name="{{d.client_name}}"
                                                    data-email-id="{{d.email_id}}"
                                                    data-contact-number="{{d.contact_number}}"
                                                    data-business-name="{{d.business_name}}"
                                                    data-brand-name="{{d.brand_name}}"
                                                    data-gst="{{d.gst}}"
                                                    data-seller-address="{{d.seller_address}}"
                                                    data-commercial-id="{{d.pricing.id}}"
                                                    data-client-designation-id="{{d.client_designation}}"
                                                    data-program-id="{{d.program.id}}"
                                                    data-program="{{d.program.program}}"
                                                    data-marketplace-id="{{d.program.marketplace.id}}"
                                                    data-marketplace="{{d.program.marketplace.marketplace}}"
                                                    data-service-id="{{d.program.marketplace.service.id}}"
                                                    data-service="{{d.program.marketplace.service.service}}"
                                                    data-segment-id="{{d.program.marketplace.service.segment.id}}"
                                                    data-segment="{{d.program.marketplace.service.segment.segment}}"
                                                    data-payment-model-id="{{d.program.payment_model.id}}"
                                                    data-payment-model="{{d.program.payment_model}}"
                                                    data-payment-terms-id="{{d.program.payment_terms.id}}"
                                                    data-payment-terms="{{d.program.payment_terms}}"
                                                    data-mou-required="{{d.program.mou_required}}"
                                                    data-paid-by-id="{{d.program.paid_by.id}}"
                                                    data-paid-by="{{d.program.paid_by}}"
                                                    data-comments="{{d.program.comments}}"
                                                    {% comment %} data-sub-program-id="{{d.service.sub_program.id}}"
                                                    data-sub-program-name="{{d.service.sub_program.sub_program}}" {% endcomment %}
                                                    
                                                    data-status="{{status}}"
                                                    data-commercial-approval-type="{{d.commercial_approval.commercial}}"
                                                    data-commercial-approval-status="{{d.commercial_approval.status}}"
                                                    data-tip="Initiate Call"
                                                    class='initiate_call tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#46A5C6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_initiate_call_white.png" %}">
                                                </div>
                                       
                                                <div 
                                                    data-lead-id="{{d.lead_id}}"
                                                    data-client-id="{{d.client_id}}"
                                                    data-tip="Add Service"
                                                    class='add_service tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#A258C5] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_add_service_white.png" %}">
                                                </div>
                                                <div 
                                                    data-lead-id="{{d.lead_id}}"
                                                    data-client-id="{{d.client_id}}"
                                                    data-lead-id="{{d.lead_id}}"
                                                    data-selected-status-id="{{d.lead_id|getStatusId}}"
                                                    data-tip="Status Update"
                                                    class='status_update tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#2F3642] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_status_update_white.png" %}">
                                                </div>
                                                <div 
                                                    data-lead-id="{{d.lead_id}}"
                                                    data-client-id="{{d.client_id}}"
                                                    data-lead-id="{{d.lead_id}}"
                                                    data-selected-status-id="{{d.lead_id|getStatusId}}"
                                                    data-tip="Follow Up History"
                                                    class='follow_up_history tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#CA02B6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_followup_history_white.png" %}">
                                                </div>
                                                {% if request.user|role_validity:'business_development_team_lead' or request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}    
                                                    <div 
                                                        data-lead-id="{{d.lead_id}}"
                                                        data-client-id="{{d.client_id}}"
                                                        data-tip="All Services"
                                                        class='all_services tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#3790B6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_all_services_white.png" %}">
                                                    </div>
                                                    
                                                    <div 
                                                        data-lead-id="{{d.lead_id}}"
                                                        data-client-id="{{d.client_id}}"
                                                        {% comment %} data-user-id="{{d.associate.id}}" {% endcomment %}
                                                        data-lead-id="{{d.lead.id}}"
                                                        data-tip="Assign Associate"
                                                        class='assign_associate tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#8E4AD2] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_assign_associate_white.png" %}">
                                                    </div>
                                                {% endif %}
                                            </td>
                                        </tr>
                                {% endwith %}
                            {% endfor %}
                        {% endwith %}

                    {% endif %}

                  </tbody>
                </table>
              </div>
        </div>

        <script>

        {% comment %} {% if request.user|role_validity:'business_development_associate' and request.user|role_validity:'business_development_team_lead' %} {% endcomment %}

        
            const lead_action_dv_bulk = document.querySelector('.lead_action_dv_bulk');
            const bulk_select_main = document.querySelector('.bulk_select_main');
            const bulk_select = document.querySelectorAll('.bulk_select');
            {% comment %} const lead_action_dv_bulk = document.querySelector('.lead_action_dv_bulk'); {% endcomment %}
            const bulk_options_select = document.querySelector('.bulk_options_select');
            console.log('bulk_options_select', bulk_options_select)
            {% comment %} const associate_select = document.querySelector('.associate_select'); {% endcomment %}

            
            bulk_options_select.addEventListener('change', async ()=>{
                const associate_select = document.querySelector('.associate_select');
                if (bulk_options_select.value === 'assign_associate'){
                    associate_select.classList.remove('hidden')

                    let a = await ftN('{% url "employee_list" attribute="team_member" %}', 'GET', { 'Content-Type': 'application/json', 'Authorization': 'Bearer '+getCookies().access}, '' )
                    console.log('a.data', a.data.data)
                    if (a.data) {
                        a.data.data.forEach(e=>{
                            const opt = document.createElement('option');
                            opt.value = e.id
                            opt.innerText = e.value
                            associate_select.append(opt)
                        })
                    }

                }
                // else if (bulk_options_select.value === 'email_proposal'){
                //     associate_select.classList.add('hidden')
                //     console.log('bulk_options_select.value', bulk_options_select.value)
                // }
                // else if (bulk_options_select.value === 'change_status'){ 
                //     associate_select.classList.add('hidden')
                //     console.log('bulk_options_select.value', bulk_options_select.value)
                // }

                else {
                    console.log('else working','lead_action_dv_bulk', bulk_options_select.value)
                    associate_select.classList.add('hidden')
                }



                document.querySelector('.bulk_action').onclick = async function (){
                    const all_leads = [];
                    const bulk_select = document.querySelectorAll('.bulk_select');
                    bulk_select.forEach(e=>{
                        if (e.checked){
                            all_leads.push(e.getAttribute('data-lead-id'))
                        }
                    })


                    if (bulk_options_select.value === 'assign_associate'){
                        if (associate_select.value !== 'default' ) {
                            let a = await ftN('{% url "assign_associate" %}', 'PUT', {'Content-Type': 'application/json', 'Authorization': 'Bearer '+getCookies().access}, JSON.stringify({'lead_id': all_leads, 'user_id': Number(associate_select.value)  }))
                            if (a){
                                poperFunction(a.status,a.message, a.status===200?true:false)
                            }
                        } else {
                            poperFunction(400,'associate not selected', false)
                        }
                    }
                    else {

                        const popup = document.createElement('popup');
                        popup.classList.value = 'bulk_action_popup absolute h-96 w-96 border border-solid border-slate-700 left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] rounded-xl bg-white z-50 overflow-hidden';
                        document.body.prepend(popup);
                        popup.innerHTML = `
                            <div class="flex h-[30px]">
                                <div class="h-[30px] w-[calc(100%-30px)] bg-slate-900 popup_heading text-white flex items-center p-2"></div>
                                <div class="h-[30px] w-[30px] bg-red-500 flex justify-center items-center p-2 close_popup cursor-pointer"> <img src='{% static "assets/images/close_button.png" %}' > </div>
                            </div>
                            <div class="popup_body p-2 h-[calc(100%-30px)]">
                            </div>
                        `;

                        popup.querySelector('.close_popup').onclick = function (){
                            popup.remove();
                        };

                        const popup_heading = document.querySelector('.popup_heading');
                        const popup_body = document.querySelector('.popup_body');


                        if (bulk_options_select.value === 'email_proposal') {

                            console.log('all_leads',all_leads);
                            
                            popup_heading.innerText = 'Email Proposal';
                            // popup_body.innerText = `(((Email Proposal)))`;
                            // const button_heading = document.querySelector('.button_heading');
                            // button_heading.innerText="Email Proposal"
                            // const content_l2 = document.querySelector('.content_l2')
                            popup_body.innerHTML = `
                                <div class="rounded-2xl w-full h-full flex justify-center items-center">
                                    <div class="card w-full h-full text-neutral-content overflow-hidden">
                    
                                        {% comment %} <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Proposal Email</div> {% endcomment %}
                                            {% comment %} <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}"> {% endcomment %}
                                    
                                            <div class="main_container h-[calc(100%)] w-full flex justify-between flex-wrap text-slate-900 bg-gray-50">
                                                <div class="main_container_inr w-full h-full flex justify-center">
                                                    <div class="h-auto w-full flex justify-start flex-col bg-gray-50 text-slate-900 text-xs p-2">
                                                        {% csrf_token %}
                                                        
                                                        <div class="w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Segment</div>
                                                            <select class="inps select_inp segment my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Segment" name="segment">
                                                                <option disabled selected value="null">Select Segment</option>
                                                                {% for d in dropdown_data %}
                                                                    {% for s in d.segment %}
                                                                        <option value="{{s.id}}">{{s}}</option>
                                                                    {% endfor %}
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                    
                                                        <div class="w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Service</div>
                                                            <select disabled class="inps select_inp service my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Service" name="service">
                                                                <option disabled selected value="null">Select Service</option>
                                                            </select>
                                                        </div>
                    
                                                        <div class="w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Marketplace</div>
                                                            <select disabled class="inps select_inp marketplace my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Marketplace" name="marketplace">
                                                                <option disabled selected value="null">Select Marketplace</option>
                                                            </select>
                                                        </div>
                    
                                                        <div class="w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Program</div>
                                                            <select data-lead-id="" data-client-id="" disabled class="inps select_inp program my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Program" name="program">
                                                                <option disabled selected value="null">Select Program</option>
                                                            </select>
                                                        </div>
                    
                                                        <div class="w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Commercial</div>
                                                            <select disabled class="inps select_inp commercial my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Commercial" name="commercial">
                                                                <option disabled selected value="null">Select Commercial</option>
                                                            </select>
                                                        </div>
                    
                                                        <div class="custom_commercial_main_dv hidden w-[100%] h-10 flex my-1 ">
                                                            <div class="flex items-center h-full w-1/4">Custom Commercial</div>
                                                            <input type="text" class="custom_commercial h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl capitalize" placeholder='Custom Commercial' name="custom_commercial" value="">
                                                        </div>
                    
                                                        <button data-lead-id="" data-client-id="" class="send_proposal_email w-full my-3 btn btn-success text-white">Submit</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>`
                    
                                // btnEventsFun()
                    
                    
                                const segment = document.querySelector('.segment');
                                const service = document.querySelector('.service');
                                const marketplace = document.querySelector('.marketplace');
                                const program = document.querySelector('.program');
                                const commercial = document.querySelector('.commercial');
                    
                                
                                interDependentFields(segment, service, 'segment', 'service')
                                interDependentFields(service, marketplace, 'service', 'marketplace')
                                interDependentFields(marketplace, program, 'marketplace', 'program')
                                {% comment %} interDependentFields(service, marketplace, 'service', 'marketplace') {% endcomment %}
                    
                    
                                program.addEventListener('change',async()=>{
                                    if (commercial.disabled){
                                        commercial.disabled = false
                                    }
                                    commercial.innerHTML = ''
                    
                                    let url = '{% url "commercial_list" lead_id="bulk" marketplace_id="**" program_id="***" %}'.replaceAll("***",program.value).replaceAll("**",marketplace.value).replaceAll("*", program.getAttribute('data-lead-id'));
                                    let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, '')
                                    if (a){
                                        if (a.status===200){
                                            const commercial = document.querySelector('.commercial');
                                            a.data.forEach(e=>{
                                                const opt = document.createElement('option')
                                                opt.value = e.id
                                                opt.innerText = e.value
                                                commercial.append(opt)
                                            })
                    
                                            const opt = document.createElement('option'); opt.value = null; opt.innerText = 'others'; commercial.append(opt)
                                        } else {
                                            poperFunction(a.status, a.message, false)
                                        }
                                    
                                    }
                                })  
                    
                                // const commercial = document.querySelector('.commercial');
                                // a.data.forEach(e=>{
                                //     const opt = document.createElement('option');
                                //     opt.value = Number(e.id)
                                //     opt.innerText = e.value
                                //     commercial.append(opt)
                                // })
                    
                    
                    
                                commercial.addEventListener('change',()=>{
                                    console.log('working')
                                    const custom_commercial_main_dv = document.querySelector('.custom_commercial_main_dv');
                                    if (commercial.selectedOptions[0].innerText.toLocaleLowerCase() === 'others' ) {
                                        custom_commercial_main_dv.classList.remove('hidden')
                                    } else {
                                        custom_commercial_main_dv.classList.add('hidden')
                                    }
                                })
                    
                                const send_proposal_email = document.querySelector('.send_proposal_email');
                                send_proposal_email.addEventListener('click', async ()=>{
                                    console.log('commercial.value', commercial.value)
                                    // if (commercial.value !== 'null'){
                                        let data = {}
                                        // const commercial = document.querySelector('.commercial');
                                        const custom_commercial = document.querySelector('.custom_commercial');
                                        if (commercial.selectedOptions[0].innerText.toLocaleLowerCase() !== 'others' ) {
                                            data['commercial_id'] = Number(commercial.value)
                                            data['lead_id'] = all_leads
                                        } else {
                                            data['commercial_id'] = null
                                            data['lead_id'] = all_leads
                                            // data['client_id'] = send_proposal_email.getAttribute('data-client-id')
                                            data['custom_commercial'] = custom_commercial.value
                                        }
                                        let url = '{% url "bulk_actions_lead" type="email_proposal" %}';
                                        addLoader();
                                        let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                                        if (a){
                                            removeLoader();
                                            if (a.status === 200){
                                                poperFunction(a.status,a.message,false)
                                                followUpCreation({'follow_up_type': 'follow_up_proposal_sent'})
                                                popup.remove()
                                            } else {
                                                poperFunction(a.status,a.message,false)
                                            }
                                        }
                                    // } else {
                                    //     poperFunction(400, 'select commercial first', false)
                                    // }
                                })
                            



                        } else if (bulk_options_select.value === 'change_status'){
                            popup_heading.innerText = 'Status Update';
                            
                            let url = '{% url "lead_status_list" %}'
                            let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
                        
                            if (a){
                                // const popup = document.createElement('div');
                                // popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center '
                                popup.innerHTML = `
                        
                                    <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Status Update</div>
                                        <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                                    
                                        <div class="main_container h-[calc(100%-35px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                                            <div class="main_container_inr w-full h-full">
                
                
                                                <div class="h-full w-full flex justify-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">
                
                                                    {% csrf_token %}
                
                                                    <div class="w-[100%] h-10 flex my-1 ">  
                                                        <div class="flex items-center h-full w-1/4">Lead Status</div>
                                                        <select class="inps select_inp lead_status_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Lead Status" name="lead_status">
                                                            <option disabled selected value="null">Select Status</option>
                                                        </select>
                                                    </div>
                
                                                    <button data-lead-id="" data-client-id="" class="lead_status_submit w-full my-3 btn btn-success text-white">Submit</button>
                
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        
                                `
                                // document.body.append(popup)
                        

                    
                                const lead_status_select = document.querySelector('.lead_status_select');
                                a.data.forEach(f=>{
                                    // console.log('fff', f)
                                    const opt = document.createElement('option');
                                    opt.value = Number(f.id)
                                    opt.innerText = f.title.replaceAll('_',' ')
                                    lead_status_select.append(opt)
                                    // if ( Number(e.getAttribute('data-selected-status-id')) === Number(f.id) ) {
                                    //     console.log(f.title)
                                    //     opt.selected = true
                                    // }
                                })
                    
                    
                                const lead_status_submit = document.querySelector('.lead_status_submit');
                                lead_status_submit.addEventListener('click',async()=>{
                                data = {}
                                const lead_status_select = document.querySelector('.lead_status_select');
                                data['lead_id'] = all_leads;
                                // data['client_id'] = lead_status_submit.getAttribute('data-client-id');
                                data['lead_status_id'] = Number(lead_status_select.value)
                                let url = '{% url "bulk_actions_lead" type="update_status" %}';
                                let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data) )
                                    if(a){
                                        poperFunction(a.status,a.message, a.status===200?true:false)
                                    }
                                })
                            }

                        } else if (bulk_options_select.value === 'add_remark'){
                            popup_heading.innerText = 'Add Remark';
                            
                            // let url = '{% url "lead_status_list" %}'
                            // let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
                        
                            // if (a){
                                // const popup = document.createElement('div');
                                // popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center '
                                popup.innerHTML = `
                        
                                    <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Add Remark</div>
                                        <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                                    
                                        <div class="main_container h-[calc(100%-35px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                                            <div class="main_container_inr w-full h-full">
                
                
                                                <div class="h-full w-full flex justify-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">
                
                                                    {% csrf_token %}
                
                                                    <div class="w-[100%] h-10 flex my-1 ">  
                                                        <div class="flex items-center h-full w-1/4">Remark</div>
                                                        <input class="inps select_inp remark_input my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Add Remark" name="remark">
                                                    </div>
                
                                                    <button data-lead-id="" data-client-id="" class="remark_submit w-full my-3 btn btn-success text-white">Submit</button>
                
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        
                                `
                                // document.body.append(popup)
                        
                                // const close_btn = popup.querySelectorAll('.close_btn');
                                // close_btn.forEach(e=>{
                                //     e.addEventListener('click',()=>{
                                //         popup.remove()
                                //     })
                                // })
                    
                                // a.data.forEach(f=>{
                                    //     // console.log('fff', f)
                                    //     const opt = document.createElement('option');
                                    //     opt.value = Number(f.id)
                                    //     opt.innerText = f.title.replaceAll('_',' ')
                                    //     lead_status_select.append(opt)
                                    //     // if ( Number(e.getAttribute('data-selected-status-id')) === Number(f.id) ) {
                                        //     //     console.log(f.title)
                                        //     //     opt.selected = true
                                        //     // }
                                        // })
                                        
                                        
                                // const lead_status_select = document.querySelector('.lead_status_select');
                                const remark_submit = document.querySelector('.remark_submit');
                                remark_submit.addEventListener('click',async()=>{
                                data = {}
                                const remark_input = document.querySelector('.remark_input');
                                data['lead_id'] = all_leads;
                                // data['client_id'] = lead_status_submit.getAttribute('data-client-id');
                                data['remark'] = remark_input.value
                                let url = '{% url "bulk_actions_lead" type="add_remark" %}';
                                let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data) )
                                    if(a){
                                        poperFunction(a.status,a.message, a.status===200?true:false)
                                    }
                                })
                            // }
                        }

                        const close_btn = popup.querySelectorAll('.close_btn');
                        close_btn.forEach(e=>{
                            e.addEventListener('click',()=>{
                                popup.remove()
                            })
                        })

                    }
                }
            })


            bulk_select.forEach(e=>{
                e.addEventListener('change',()=>{
                    if (e.checked){
                        lead_action_dv_bulk.classList.remove('hidden')
                    }
                })
            })

            bulk_select_main.addEventListener('change',()=>{
                if (bulk_select_main.checked){
                    lead_action_dv_bulk.classList.remove('hidden')
                    bulk_select.forEach(e=>{
                        e.checked = true
                    })
                } else {
                    lead_action_dv_bulk.classList.add('hidden')
                    bulk_select.forEach(e=>{
                        e.checked = false
                    })
                }
            })
        {% comment %} {% endif %} {% endcomment %}



        </script>

        <div class="flex justify-between items-center h-[50px] relative">
            
            {% comment %} <div class="w-3/4"> {% endcomment %}
                {% if data != None %}
                    {% include 'layout/pagination.html' with data=data %}
                {% endif %} 
            {% comment %} </div> {% endcomment %}

    
            <div class="absolute top-[20px] right-[20px] w-1/4 flex justify-center items-center">
                <div class="text-xs mr-2">Results</div>
                <select class="p-1 rounded-lg text-xs results_selection">
                    <option {% if request.GET.rs == '25' %}selected disabled{% endif %} value="25">25</option>
                    <option {% if request.GET.rs == '50' %}selected disabled{% endif %} value="50">50</option>
                    <option {% if request.GET.rs == '75' %}selected disabled{% endif %} value="75">75</option>
                    <option {% if request.GET.rs == '100' %}selected disabled{% endif %} value="100">100</option>
                </select>
            </div>

            {% comment %} <div class="join">
                <button class="join-item btn btn-sm btn-active">2</button>
            </div> {% endcomment %}
        </div>
    </div>
</div>



{% comment %} <script src="{% static "assets/js/confirmation_popup.js" %}" ></script> {% endcomment %}
{% comment %} <script src="{% static "assets/js/user_edit_popup.js" %}" ></script> {% endcomment %}
<script src="{% static "assets/js/fetch.js" %}" ></script>
<script src="{% static "assets/js/poper.js" %}" ></script>
<script src="{% static "assets/js/getcookies.js" %}" ></script>


<script>

    document.querySelector('.results_selection').onchange = function (e){
        let link = addParamsToLink(window.location.href, 'rs', e.target.selectedOptions[0].value)
        window.location.href = link
    } ;


    const main_dropdown_data = [
        {% for d in dropdown_data %}
        {% for k,v in d.items %}
            { 'table': '{{k}}', 'value': [
                {% if k == 'segment' %}
                    {% for i in v %}{'id': {{i.id}}, 'value': '{{i.segment}}' } ,{% endfor %},
            
                {% elif k == 'service' %}
                    {% for i in v %}{ 'segment': {'id': {{i.segment.id}}, 'value': '{{i.segment.segment}}'}, 'service': {'id': {{i.id}}, 'value': '{{i.service}}'} } ,{% endfor %},

                {% elif k == 'marketplace' %}
                    {% for i in v %}{ 'segment': {'id': {{i.service.segment.id}}, 'value': '{{i.service.segment.segment}}'}, 'service': {'id': {{i.service.id}}, 'value': '{{i.service.service}}'} , 'marketplace': {'id': {{i.id}}, 'value': '{{i.marketplace}}'}, } ,{% endfor %},

                {% elif k == 'program' %}
                    {% for i in v %} { 'segment': {'id': {{i.marketplace.service.segment.id}}, 'value': '{{i.marketplace.service.segment.segment}}'}, 'service': {'id': {{i.marketplace.service.id}}, 'value': '{{i.marketplace.service.service}}'}, 'marketplace': {'id': {{i.marketplace.id}}, 'value': '{{i.marketplace.marketplace}}'}, 'program': {'id': {{i.id}}, 'value': '{{i.program}}'},  } ,{% endfor %},
                
                    {% endif %}
                ]},
         {% endfor %}
        {% endfor %}
    ]


    function interDependentFields(main_target, append_target, search_table, result_table){
        main_target.addEventListener('change',()=>{
            append_target.innerHTML = `<option selected disabled value=default class="capitalize">Select ${result_table}</option>`
            main_dropdown_data.forEach(f=>{
                if(f.table === result_table){
                    f.value.forEach(g=>{
                        if (g[search_table].id == main_target.value) {
                            console.dir(append_target)
                            console.log(append_target.disabled)
                                if (append_target.disabled){
                                    append_target.disabled = false
                                }
                                const opt = document.createElement('option');
                                opt.value = g[result_table].id
                                opt.innerText = g[result_table].value
                                append_target.append(opt)
                        }
                    })
                }
            })
        })
    }

    function interDependentFieldsInput(main_target, append_target){
        console.log(main_target, append_target)
        main_target.addEventListener('change',()=>{
            if (append_target.disabled){
                append_target.disabled = false
            }
        })
    }

</script>



<script>

    function userEditPopUp(data){

        const popup = document.createElement('div');
        popup.classList.value = 'w-screen h-screen absolute top-0 left-0 flex justify-center items-center bg-[rgba(0,0,0,0.7)] z-50'
        popup.innerHTML = `
        
        <form action="${data ? '{% url "update_user_account" %}' : '{% url "create_user_account" %}'}" id="add_user" method="POST">
            <div class="card w-[700px] h-[500px] bg-white text-neutral-content overflow-hidden">
                <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">View/Edit Lead</div>
                    <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px]" src="{% static "assets/images/close_button.png" %}">
                <div class="h-[40px] flex justify-between items-center text-white px-4 border-b bg-gray-200">
                    <div class="text-slate-900 font-bold">User Management</div>
                    <label class="flex justify-center text-slate-900 select-none cursor-pointer"><span>Edit</span><input type="checkbox" class="edit_toggle toggle ml-3" /><label>
                </div>
                <div class="h-[calc(100%-100px)] w-full flex justify-between flex-wrap p-3 overflow-y-scroll bg-gray-50 text-slate-900 text-xs">

                    {% csrf_token %}

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Hot Lead</div>
                        <select disabled required class="select_inp hot_lead my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" name="hot_lead">
                          <option disabled selected value="null">Hot Lead</option>
                          {% for s in hot_lead %}<option value="{{s.id}}">{{s.title}}</option>{% endfor %}
                        </select>
                    </div>

                    
                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Client Id</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder="Client Id" name="client_id" value="${data ? data.client_id : ''}">
                    </div>

        {% if request.user|role_validity:'business_development_associate' or request.user|role_validity:'business_development_team_lead' %}

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Lead Id</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder="Lead Id" name="lead_id" value="${data ? data.lead_id : ''}">
                    </div>

        {% endif %}

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Provider Id</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="provider_id" value="${data ? data.provider_id : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Requester Id</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="requester_id" value="${data ? data.requester_id : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Requester Location</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="requester_location" value="${data ? data.requester_location : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Requester Sell In Country</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="requester_sell_in_country" value="${data ? data.requester_sell_in_country:''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Service Requester Type</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="service_request_type" value="${data ? data.service_request_type:''}">
                    </div>



                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Client Name</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="client_name" value="${data ? data.client_name : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Email Id</div>
                        <input disabled type="email" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="email_id" value="${data ? data.email_id : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Contact Number</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="contact_number" value="${data ? data.contact_number : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Business Name</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="business_name" value="${data ? data.business_name : ''}">
                    </div>


                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Client Turnover</div>
                        <select disabled required class="inps h-full select_inp client_turnover my-1 border w-3/4 px-2 rounded-xl capitalize text-slate-900" name="client_turnover">
                            <option disabled selected value="null">select client turnover</option>
                            {% for s in client_turnover %}<option value="{{s.id}}">{{s.title}}</option>{% endfor %}
                        </select> 
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Business Category</div>
                        <select disabled required class="inps select_inp business_category my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" name="business_category">
                          <option disabled selected value="null">Business Category</option>
                          {% for s in business_category %}<option value="{{s.id}}">{{s.title}}</option>{% endfor %}
                        </select>
                    </div>



                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">GST</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" name="gst" value="${data ? data.gst : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Seller Address</div>
                        <input disabled type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl capitalize" name="seller_address" value="${data ? data.seller_address : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Upload Date</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" value="${data ? data.upload_date : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Lead Owner</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" value="${data ? data.lead_owner : ''}">
                    </div>

                    <div class="w-[49%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Associate</div>
                        <input disabled type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" value="${data ? data.associate : ''}">
                    </div>

                </div>
                <button disabled data-lead-id="${data? data.lead_id: ''}" class="inps update btn btn-success text-white">Success</button>
            </div>
        </form>
        `

        if (data.client_turnover !== 'None' && data.client_turnover !== null  ){
            console.log('data.client_turnover', data.client_turnover)
            const client_turnover = popup.querySelector('.client_turnover');
            Array.from(client_turnover.options).forEach(e=>{
                if(
                    e.value === 'null'){e.remove()
                }
                if (Number(e.value) === Number(data.client_turnover_id)){
                    e.selected = true
                    e.disabled = true
                }
            })
        }

        if (data.hot_lead) {
            const hot_lead = popup.querySelector('.hot_lead');
            const opt = document.createElement('option');
            opt.selected = true
            opt.disabled = true
            opt.value = data.hot_lead
            opt.innerText = data.hot_lead
            hot_lead.prepend(opt)
        }
            

        if (data.business_category !== 'None' && data.business_category !== null ){
            const business_category = popup.querySelector('.business_category');
            Array.from(business_category.options).forEach(e=>{
                if(e.value === 'null'){e.remove()}
                if (Number(e.value) === Number(data.business_category_id)){
                    e.selected = true
                    e.disabled = true

                    {% comment %} const opt = document.createElement('option'); {% endcomment %}
                    {% comment %} opt.selected = true
                    opt.disabled = true
                    opt.value = e.value
                    opt.innerText = e.innerText
                    business_category.prepend(opt) {% endcomment %}
                }
            })
        }




        popup.querySelector('#add_user').onsubmit = function() {
          const select = popup.querySelector('.department');
          if (select.value === "") {
            console.log('working department')
            return false; // Prevent form submission
          }
          return true; // Allow form submission
        };

        
        document.body.append(popup)


        const update = document.querySelector('.update');
        if (update){
            update.addEventListener('click', async (e)=>{
                e.preventDefault()
                const inps = popup.querySelectorAll('.inps')
                main_data = {}

                inps.forEach((e,i)=>{
                    console.log(e)
                    if (e.localName === 'input'){
                        main_data[e.name] = e.value===''?null:e.value
                    }

                    if (e.localName === 'select'){
                        main_data[e.name] = Number(e.value)
                    }

                })

                main_data['lead_id'] = update.getAttribute('data-lead-id')

                let url = '{% url "update_lead" client_id=0 %}'.replace(0,data.client_id)

                let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(main_data))
                if (a){
                    poperFunction(a.status,a.message, a.status===200?true:false)
                }   

            })
        }
    
        const close_btn = popup.querySelectorAll('.close_btn');
        close_btn.forEach(e=>{
            e.addEventListener('click',()=>{
                popup.remove()
            })
        })
    
        const edit_toggle = popup.querySelector('.edit_toggle');
        edit_toggle.addEventListener('click',()=>{
          const inps = document.querySelectorAll('.inps');
    
          inps.forEach(e=>{
            if (!edit_toggle.checked){
              e.disabled = true
            } else {
              e.disabled = false
            }
          })
        })
    
    }


    const approve = document.querySelectorAll('.approve');
    approve.forEach(e=>{
        e.addEventListener('click', async ()=>{
            let url = '{% url "approve_commercial" approval_type=request.GET.type|default:"commercial" lead_id=0 %}'.replaceAll(0, e.getAttribute('data-lead-id'));

            let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
            if (a){
                poperFunction(a.status, a.message, a.status === 200?true:false)
            }
        })
    })








function  mainEditFunction() {
    const archive = document.querySelectorAll('.archive');
    archive.forEach(e=>{
        e.addEventListener('click', async ()=>{
            let url = '{% url "lead_visibility" type="archive" id=0 %}'.replaceAll(0, e.getAttribute('data-id'));

            let a = await ftN(url, 'DELETE', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
            if (a){
                poperFunction(a.status, a.message, a.status === 200?true:false)
            }
        })
    })

    const restore = document.querySelectorAll('.restore');
    restore.forEach(e=>{
        e.addEventListener('click', async ()=>{
            let url = '{% url "lead_visibility" type="restore" id=0 %}'.replaceAll(0, e.getAttribute('data-id'));

            let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
            if (a){
                poperFunction(a.status, a.message, a.status === 200?true:false)
            }
        })
    })


    const all_services = document.querySelectorAll('.all_services');
    all_services.forEach(e=>{
        e.addEventListener('click', async ()=>{

            let url = '{% url "lead_related_services" client_id=0 %}'.replaceAll(0, e.getAttribute('data-client-id'));
            let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

            const popup = document.createElement('div');
            popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50'
            popup.innerHTML = `
                <div class="w-[600px] h-[500px] bg-white rounded-2xl">

                    <div class="card w-[600px] h-[500px] bg-white text-neutral-content overflow-hidden">
                        <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Services Overview</div>
                            <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                        <div class="h-[40px] flex justify-between items-center text-white px-4 border-b bg-gray-200">
                            <div class="text-slate-900 font-bold">List of service seller enrolled with us</div>
                            {% comment %} <label class="flex justify-center text-slate-900"><span>Edit</span><input type="checkbox" class="edit_toggle toggle ml-3" /><label> {% endcomment %}
                        </div>
                            <div class="main_container h-[calc(100%-100px)] w-full flex justify-between flex-wrap p-3 overflow-y-scroll text-slate-900 bg-gray-50">

                                <div class="overflow-x-auto">
                                    <table class="table table-zebra">
                                        <!-- head -->
                                        <thead>
                                          <tr>
                                            <th class="text-xs p-1">Lead id</th>
                                            <th class="text-xs p-1">Segment</th>
                                            <th class="text-xs p-1">Service</th>
                                            <th class="text-xs p-1">Marketplace</th>
                                            <th class="text-xs p-1">Program</th>
                                            {% comment %} <th class="text-xs">Sub Program</th> {% endcomment %}
                                            <th class="text-xs p-1">Associate</th>
                                            <th class="text-xs p-1">Status</th>
                                          </tr>
                                        </thead>
                                        <tbody class="table_body">

                                        </tbody>
                                </table>

                                </div>

                            </div>
                        </div>
                    </div>
                    
                </div>
            `
            document.body.append(popup)

            if (a){

                const main_container = document.querySelector('.main_container');
                const table_body = document.querySelector('.table_body');
                const keys =  Object.keys(a.data[0])
                
                a.data.forEach(e=>{
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                        <td class="capitalize text-xs p-1" >${e.lead_id}</td>
                        <td class="capitalize text-xs p-1" >${e.segment.value}</td>
                        <td class="capitalize text-xs p-1" >${e.service.value}</td>
                        <td class="capitalize text-xs p-1" >${e.marketplace.value}</td>
                        <td class="capitalize text-xs p-1" >${e.program.value}</td>
                        {% comment %} <td class="capitalize text-xs p-1" >${e.sub_program.value}</td> {% endcomment %}
                        <td class="capitalize text-xs p-1" >${e.associate.name}</td>
                        <td class="capitalize text-xs p-1" >${e.status.replaceAll('_',' ')}</td>
                    `
                    table_body.append(tr)

                })
            }


            const close_btn = popup.querySelectorAll('.close_btn');
            close_btn.forEach(e=>{
                e.addEventListener('click',()=>{
                    popup.remove()
                })
            })
            
        })
    })


    const add_service = document.querySelectorAll('.add_service');
    add_service.forEach(e=>{
        e.addEventListener('click',()=>{

            const popup = document.createElement('div');
            popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50'
            popup.innerHTML = `
                <div class="w-[600px] h-[500px] bg-white rounded-2xl">

                    <div class="card w-[600px] h-[500px] bg-white text-neutral-content overflow-hidden">
                        <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Add Service</div>
                            <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                        <div class="h-[40px] flex justify-between items-center text-white px-4 border-b bg-gray-200">
                            <div class="text-slate-900 font-bold">Add New Service</div>

                            {% comment %} <label class="flex justify-center text-slate-900"><span>Edit</span><input type="checkbox" class="edit_toggle toggle ml-3" /><label> {% endcomment %}

                            </div>
                            <div class="main_container h-[calc(100%-75px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                                <div class="w-full h-full">

                                        <div class="card w-full h-full bg-white text-neutral-content overflow-hidden">
                                            <div class="h-[calc(100%-40px)] w-full flex justify-between flex-wrap p-3 overflow-y-scroll bg-gray-50 text-xs">

                                                {% csrf_token %}


                                                {% comment %} <div class="w-[100%] border rounded-xl p-5 my-2 bg-slate-100">
                                                    {% for s in segment %}
                                                        <span class="capitalize text-slate-900">{{s}}</span>
                                                        <div class="w-[95%] text-slate-900 bg-white rounded-lg p-2 m-3">
                                                            {% for sl in service_list %}
                                                                {% if sl.segment.id == s.id %}
                                                                    <div class="my-3">
                                                                        <div class="text-gray-700 capitalize font-semibold m-2 ">{{sl.service}}</div>
                                                                        <div class="ml-5 flex w-full flex-wrap">
                                                                            {% for m in marketplace_list %}
                                                                                {% if sl.service.id == m.service.id %}
                                                                                    <div class="capitalize mx-2 text-gray-500 w-1/4"><label><input data-segment="{{s.id}}" data-service="{{sl.service.id}}" data-marketplace="{{m.marketplace.id}}" class="inp service checkbox_inp" type="checkbox" name="service" value="{{m.id}}" id="service{{forloop.counter}}" ><span class="ml-2">{{m.marketplace}}</span></label></div>
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endfor %}
                                                        </div>
                                                    {% endfor %}
                                                </div> {% endcomment %}

                                                <div class="w-full h-auto p-2 selected_program_view_dv hidden">
                                                    <div class="flex flex-col p-2 bg-slate-300 rounded-xl p-2">
                                                        <div class="text-center text-slate-900 h-[20px]">Selected Programs</div>
                                                        <div class="h-[calc(100%-20px)] text-slate-900">
                                                        <div class="btn btn-error btn-xs clear_selected_program">Clear All</div>
                                                            <ul class="selected_programs_view h-full w-full overflow-auto">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="w-[100%] user_program_dv bg-slate-100 text-slate-900 user_service_dv flex h-[400px]" data-name="program" >
                                                    {% for d in dropdown_data %}
                                                        {% for key,value in d.items %}
                                                            <div class="flex-1 border {{key}}_container {% if key != 'segment' %}invisible{% endif %}">
                                                                <div class="flex justify-center my-2">
                                                                    <div class="btn btn-warning btn-xs select_all_{{key}}">Select All {{key}}</div>
                                                                </div>
                                                                <div class="overflow-x-auto">
                                                                    <table class="table">
                                                                        <thead>
                                                                            <tr>
                                                                                {% if data != 'no data' %}
                                                                                    {% if key == 'segment' %}
                                                                                        <th class="p-1">Segment</th>
                                                                                    {% endif %}
                                                                                    {% if key == 'service' %}
                                                                                        <th class="p-1">Service</th>
                                                                                    {% endif %}
                                                                                    {% if key == 'marketplace' %}
                                                                                        <th class="p-1">Marketplace</th>
                                                                                    {% endif %}
                                                                                    {% if key == 'program' %}
                                                                                        <th class="p-1">Program</th>
                                                                                    {% endif %}
                                                                            </tr>
                                                                                {% else %}
                                                                                    <div class="h-12 flex justify-center items-center bg-gray-200">no data</div>
                                                                                {% endif %}
                                                                        </thead>
                                                                        <tbody class="text-xs">                                                    
                                                                            {% if data != 'no data' %}
                                                                                {%for d in value%}
                                                                                    <tr class="border-b border-slate-200 shadow-sm hover:shadow-md">
                                                                                        {% if key == 'segment' %}
                                                                                            <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-id="{{d.id}}" >{{d.segment|customreplacespace:"_"}}</td>
                                                                                        {% elif key == 'service' %}
                                                                                            <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-segment-id="{{d.segment.id}}", data-id="{{d.id}}">{{d.service|customreplacespace:"_"}}</td>                                                    
                                                                                        {% elif key == 'marketplace' %}
                                                                                            <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-service-id="{{d.service.id}}" data-id="{{d.id}}"  data-id="{{d.data}}">{{d.marketplace|customreplacespace:"_"}}</td>
                                                                                        {% elif key == 'program' %}
                                                                                            <td class="edit_{{key}} p-1 capitalize cursor-pointer {{key}}_item flex justify-between" data-type="{{key}}" data-marketplace-id="{{d.marketplace.id}}" data-id="{{d.id}}">
                                                                                                <span>{{d.program|customreplacespace:"_"}}</span> 
                                                                                                <button data-id="{{d.id}}" class="selectedProgramBtn btn btn-xs btn-success text-white">Select</button>
                                                                                                <button data-id="{{d.id}}" class="removeProgramBtn hidden btn btn-xs btn-error text-white">Remove</button>
                                                                                            </td>
                                                                                        {% endif %}
                                                                                    </tr>
                                                                                {% endfor %}
                                                                            {% endif %}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    {% endfor %}
                                                </div>



                            
                                            </div>
                                            <button data-client-id="${e.getAttribute('data-client-id')}"" class="inps add_service_btn btn btn-success text-white">Submit</button>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `
            document.body.append(popup)

            const close_btn = popup.querySelectorAll('.close_btn');
            close_btn.forEach(e=>{
                e.addEventListener('click',()=>{
                    popup.remove()
                })
            })


            {% for d in dropdown_data %}
            {% for key,value in d.items %}
                // console.log(`d {{key}}`);
    
    
                    const select_all_{{key}} = popup.querySelector('.select_all_{{key}}')
                    select_all_{{key}}.addEventListener('click', ()=>{
                        let dataList;
    
                        {% if key == 'segment' %}

                            dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                            
                        {% elif key == 'service' %}
    
                            dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.segment.id===Number(selectedSegment)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                        
                        {% elif key == 'marketplace' %}
    
                            console.log('selected service', selectedService);
                        
                            dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.service.id===Number(selectedService)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                        
                        {% elif key == 'program' %}
                        
                            dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.marketplace.id===Number(selectedMarketplace)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                        
                        {% endif %}
    
                        if (dataList[0].length > 0 ){
                            dataList[0].forEach(e=>{
                                selected_programs_list.push(e)
                            })
                            selectedProgramsViewFunc(dataList[0])
                        }
    
                    })
    
    
    
                    const {{key}}_item = document.querySelectorAll('.{{key}}_item')
                    {{key}}_item.forEach(e=>{
                        e.addEventListener('click', ()=>{
                            highlighter({{key}}_item, e)
                            let containers = defineContainers();
                            
                            {% if key == 'segment' %}

                            
                            if (containers.service.classList.value.includes('invisible')){
                                containers.service.classList.remove('invisible');
                            }

                                containers.marketplace.classList.add('invisible');
                                containers.program.classList.add('invisible');
                                const service_list = document.querySelectorAll('.service_item');
                                service_list.forEach(f=>{
                                    f.parentElement.classList.add('hidden');
                                })



                                service_list.forEach(f=>{
                                    if (Number(f.getAttribute('data-segment-id')) === Number(e.getAttribute('data-id'))){
                                        f.parentElement.classList.remove('hidden');

                                    }
                                })

                                console.log('segment select working')
    
                                selectedSegment = e.getAttribute('data-id');
    
                            {% elif key == 'service' %}
                                if (containers.marketplace.classList.value.includes('invisible')){
                                    containers.marketplace.classList.remove('invisible');
                                }
                                containers.program.classList.add('invisible');
                                const marketplace_list = document.querySelectorAll('.marketplace_item');
                                marketplace_list.forEach(f=>{
                                    f.parentElement.classList.add('hidden');
                                })
                                marketplace_list.forEach(f=>{
                                    if (Number(f.getAttribute('data-service-id')) === Number(e.getAttribute('data-id'))){
                                        f.parentElement.classList.remove('hidden');
                                    }
                                })
                                selectedService = e.getAttribute('data-id');
    
                            {% elif key == 'marketplace' %}
                                if (containers.program.classList.value.includes('invisible')){
                                    containers.program.classList.remove('invisible');
                                }
                                const program_list = document.querySelectorAll('.program_item');
                                program_list.forEach(f=>{
                                    f.parentElement.classList.add('hidden');
                                })
                                program_list.forEach(f=>{
                                    if (Number(f.getAttribute('data-marketplace-id')) === Number(e.getAttribute('data-id'))){
                                        f.parentElement.classList.remove('hidden');
                                    }
                                })
                                selectedMarketplace = e.getAttribute('data-id');
    
                            {% endif  %}
                        })
                    })

            {% endfor %}
        {% endfor %}


        const clear_selected_program = document.querySelector('.clear_selected_program');
        clear_selected_program.addEventListener('click', clearSelectedProgram )

        const selectedProgramBtn = document.querySelectorAll('.selectedProgramBtn');
        {% comment %} const removeProgramBtn = document.querySelectorAll('.removeProgramBtn'); {% endcomment %}
        selectedProgramBtn.forEach((e, i)=>{
            e.addEventListener('click',(f)=>{
                f.preventDefault()
                selected_programs_list.push(Number(e.getAttribute('data-id')));
                e.classList.add('hidden')
                // removeProgramBtn[i].classList.remove('hidden')
                selectedProgramsViewFunc([Number(e.getAttribute('data-id'))]);
            })
        })



            
            // const program = document.querySelectorAll('.program')
            // program.forEach(e=>{
            //     e.addEventListener('change',()=>{                    
            //         const sub_program = document.querySelector('.sub_program');
            //         if (e.selectedOptions[0].innerText.toLocaleLowerCase() === 'funded'){
            //                 sub_program.classList.remove('hidden')
            //             } else {
            //                 sub_program.classList.add('hidden')
            //             }
            //     })
            // })

            const add_service_btn = document.querySelectorAll('.add_service_btn');
            add_service_btn.forEach(e=>{
                e.addEventListener('click',async ()=>{

                    const client_id = e.getAttribute('data-client-id')
                    // const segment = document.querySelector('.segment')
                    // const program = document.querySelector('.program')
                    // const marketplace = document.querySelector('.marketplace')
                    // const sub_program = document.querySelector('.sub_program')
                    // const service = document.querySelectorAll('.service')

                    
                    
                    // let serviceList = Array.from(service).filter(e=> e.checked).map(e=>Number(e.value))
                    data = {}
                    
                    data['program'] = selected_programs_list;
                    data['client_id'] = client_id
                    // data['service'] = Array.from(service).filter(e=>e.checked).map(e=> ({'segment': Number(e.getAttribute('data-segment')), 'service': Number(e.getAttribute('data-service')), 'marketplace': Number(e.getAttribute('data-marketplace'))}) )
                    
                    //let data = {client_id: client_id, segment: Number(segment.value), service: serviceList, marketplace: Number(marketplace.value), program: Number(program.value) }
                    //sub_program: Number(sub_program.value)

                    let url = '{% url "add_service_category"  %}'
                    let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){
                        poperFunction(a.status, a.message, a.status === 200?true:false)
                    }
                })
            })

        })
    })


    const view_edit = document.querySelectorAll('.view_edit');
    view_edit.forEach(e=>{
        e.addEventListener('click',()=>{
            data = {
                client_id: e.getAttribute('data-client-id'),
                lead_id: e.getAttribute('data-lead-id'),
                request_id: e.getAttribute('data-request-id'),
                provider_id: e.getAttribute('data-provider-id'),
                requester_id: e.getAttribute('data-requester-id'),
                client_name: e.getAttribute('data-client-name'),
                email_id: e.getAttribute('data-email-id'),
                contact_number: e.getAttribute('data-contact-number'),
                requester_location: e.getAttribute('data-requester-location'),
                business_name: e.getAttribute('data-business-name'),
                requester_sell_in_country: e.getAttribute('data-requester-sell-in-country'),
                gst: e.getAttribute('data-gst'),
                service_request_type: e.getAttribute('data-service-request-type'),
                upload_date: e.getAttribute('data-upload-date'),
                seller_address: e.getAttribute('data-seller-address'),
                lead_owner_id: e.getAttribute('data-lead-owner-id'),
                lead_owner: e.getAttribute('data-lead-owner'),
                client_turnover_id: e.getAttribute('data-client-turnover-id'),
                client_turnover: e.getAttribute('data-client-turnover'),
                segment: e.getAttribute('data-segment'),
                associate_id: e.getAttribute('data-associate-id'),
                associate: e.getAttribute('data-associate'),
                business_category: e.getAttribute('data-business-category'),
                business_category_id: e.getAttribute('data-business-category-id'),
                hot_lead: e.getAttribute('data-hot-lead'),

                program_id: e.getAttribute('data-program-id'),
                program: e.getAttribute('data-program'),
                marketplace_id: e.getAttribute('data-marketplace-id'),
                marketplace: e.getAttribute('data-marketplace'),
                service_id: e.getAttribute('data-service-id'),
                service: e.getAttribute('data-service'),
                segment: e.getAttribute('data-segment-id'),
                segment: e.getAttribute('data-segment'),
                payment_mdoel_id: e.getAttribute('data-payment-model-id'),
                payment_model: e.getAttribute('data-payment-model'),
                payment_terms_id: e.getAttribute('data-payment-terms-id'),
                payment_terms : e.getAttribute('data-payment-terms'),
                mou_required: e.getAttribute('data-mou-required'),
                paid_by_id: e.getAttribute('data-paid-by-id'),
                paid_by: e.getAttribute('data-paid-by'),
                comments: e.getAttribute('data-comments'),

            }

            userEditPopUp(data)
        })
    })




const create_lead = document.querySelector('.create_lead');
create_lead.addEventListener('click',()=>{

    const popup = document.createElement('div');
    popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50 p-10'
    popup.innerHTML = `
        <div class="w-full h-full bg-white rounded-2xl">

            <div class="card w-full h-full bg-white text-neutral-content overflow-hidden">
                <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Create Lead</div>
                    <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                <div class="h-[40px] w-full flex justify-between items-center text-white px-4 border-b bg-gray-200">
                    <div class="text-slate-900 font-bold w-full">
                        <div role="tablist" class="tabs tabs-boxed">
{% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}
                            
                            <a role="tab" type="upload" class="createLead_tab tab tab-active">Upload</a>
{% endif %}
                            <a role="tab" type="manual" class="createLead_tab tab">Manual</a>
                          </div>
                    </div>

                    {% comment %} <label class="flex justify-center text-slate-900"><span>Edit</span><input type="checkbox" class="edit_toggle toggle ml-3" /><label> {% endcomment %}

                    </div>
                    <div class="main_container h-[calc(100%-75px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                        <div class="main_container_inr w-full h-full">


                            <div class="h-2/4 w-full flex justify-center items-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">
                                {% csrf_token %}
                                <div class="h-auto w-auto">
                                    <label class="form-control w-full max-w-xs">
                                        <div class="label text-center">
                                          <span class="label-text">Upload a file from your computer</span>
                                        </div>
                                        
                                        <input type="file" class="upload_lead_inps file-input file-input-bordered w-full max-w-xs" />
                                        <button disabled class="w-full my-6 upload_lead_file btn btn-success text-white">Upload</button>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    `
    document.body.append(popup)

    const close_btn = popup.querySelectorAll('.close_btn');
    close_btn.forEach(e=>{
        e.addEventListener('click',()=>{
            popup.remove()
        })
    })


{% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}

    function uploadEvents(){
        const upload_lead_inps = document.querySelector('.upload_lead_inps')
        const upload_lead_file = document.querySelector('.upload_lead_file');
    
        if (upload_lead_inps){
            upload_lead_inps.addEventListener('change',()=>{
                if(upload_lead_inps.files[0].type === 'text/csv'){
    
                    upload_lead_file.disabled = false
                    upload_lead_file.addEventListener('click',async ()=>{
                            let formdata = new FormData()
                            formdata.append('file', upload_lead_inps.files[0])
    
                            let url = '{% url "create_lead_upload" %}'
                            let a = await ftN(url, 'POST', {'Authorization': `Bearer ${getCookies().access}`}, formdata);
                            if (a){ 
                                const main_container_inr = document.querySelector('.main_container_inr');
                                const div = document.createElement('div')
                                div.classList.value = 'h-2/4 w-full overflow-scroll border-t'
                                div.innerHTML = `
    
                                <div class="overflow-x-auto">
                                    <div>Results: </div>
                                    <table class="table table-zebra">
                                      <!-- head -->
                                      <thead>
                                        <tr>
                                          <th class="text-xs">Error</th>
                                          <th class="text-xs">Duplicate Leads</th>
                                          <th class="text-xs">Remarks</th>
                                          <th class="text-xs">Client Id</th>
                                          <th class="text-xs">Client Name</th>
                                          <th class="text-xs">Segment</th>
                                          <th class="text-xs">Service</th>
                                          <th class="text-xs">Marketplace</th>
                                        </tr>
                                      </thead>
                                      <tbody class="table_body">
                                      </tbody>
                                    </table>
                                  </div>
                                `
                                main_container_inr.append(div)
    
                                const table_body = document.querySelector('.table_body');
                                a.data.forEach(e=>{
                                    const tr = document.createElement('tr');
                                    tr.innerHTML = `
                                        <td class="text-xs ${e.error_message?'text-red-800':'text-slate-900'}" >${e.error_message ? e.error_message : 'uploaded' }</td>
                                        <td class="text-xs">${e.duplicate_leads? e.duplicate_leads.map(e=>e.data)[0].map(item=>`${item.lead_id}`).join(', '):""}</td>
                                        <td class="text-xs">${e.duplicate_leads? e.duplicate_leads.map(e=>e.data)[0].map(item=>`${item.remarks}`).join(', '):""}</td>
                                        <td class="text-xs">${e.duplicate_leads? e.duplicate_leads.map(item=>`${item.client_id}`).join(', '): e.client_id }</td>
                                        <td class="text-xs">${e.client_name}</td>
                                        <td class="text-xs">${e.segment}</td>
                                        <td class="text-xs">${e.service_category}</td>
                                        <td class="text-xs">${e.marketplace}</td>
                                    `
                                    table_body.append(tr)
    
                                })
    
                            }
                    })
                    
                } else {
                    upload_lead_file.disabled = true
                    upload_lead_inps.classList.value += ' border-2 border-red-700';
                }
            })
        }
    }

{% endif %}


{% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}

    const createLead_tab = document.querySelectorAll('.createLead_tab');
    createLead_tab.forEach(e=>{
        e.addEventListener('click',()=>{
            createLead_tab.forEach(e=>{
                e.classList.remove('tab-active')
            })
            
            e.classList.add('tab-active')

{% endif %}

            const main_container_inr = document.querySelector('.main_container_inr');

{% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}

            main_container_inr.innerHTML = ''
            if (e.type === 'upload') {

                main_container_inr.innerHTML = `
                <div class="h-2/4 w-full flex justify-center items-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">
                    {% csrf_token %}
                    <div class="h-auto w-auto">
                        <label class="form-control w-full max-w-xs">
                            <div class="label text-center">
                              <span class="label-text">Upload a file from your computer</span>
                            </div>
                                <input type="file" class="file-input upload_lead_inps file-input-bordered w-full max-w-xs" />
                                <button disabled class="inps w-full my-6 upload_lead_file btn btn-success text-white">Upload</button>
                        </label>
                    </div>
                </div>`

                uploadEvents()

            } else if (e.type === 'manual') {

{% endif %}


                main_container_inr.innerHTML = `

                <div class="h-[calc(100%-50px)] w-full flex justify-between flex-wrap p-3 overflow-y-scroll bg-gray-50 text-slate-900 text-xs">
                    {% csrf_token %}
                    <div class="w-[100%] h-10 flex my-1 items-center ">
                        <div class="flex items-center h-full w-1/4 select-none">Hot Lead</div>
                        <input type="checkbox" name="hot_lead" class="check_inp toggle toggle-warning" />

                        {% comment %} <input type="text" class="h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" value=""> {% endcomment %}
                    </div>

                    <div class="w-[100%] h-10 flex my-1 items-center ">
                        <span class="text-red-700 text-bolder text-lg">*</span>
                        <div class="flex items-center h-full w-1/4 select-none">Client Name</div>
                        <input type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='Client Name' name="client_name" value="">
                    </div>

                    <div class="w-[100%] h-10 flex my-1 items-center ">
                        <span class="text-red-700 text-bolder text-lg">*</span>
                        <div class="flex items-center h-full w-1/4 select-none">Phone Number</div>
                        <div class="w-3/4 h-full flex items-center">
                            <select class=" country_code w-[25%] h-full rounded-xl border">
                                {% for c in country_code %}
                                    <option {% if c.name == 'India' %}selected{% endif %} value="{{c.dial_code}}">{{c.name}} - ({{c.dial_code}})</option>
                                {% endfor %}
                            </select>
                            <input type="number" class="inps ml-2 h-full w-[70%] my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='Phone Number' name="phone_number" value="">
                        </div>
                    </div>

                    <div class="w-[100%] h-10 flex my-1 items-center ">
                        <div class="flex items-center h-full w-1/4 select-none">Email Id</div>
                        <input type="email" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='Email ID' name="email_id" value="">
                    </div>


                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4 select-none">Business Name</div>
                        <input type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='Business Name' name="business_name" value="">
                    </div>

                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4 select-none">Brand Name</div>
                        <input type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='Brand Name' name="brand_name" value="">
                    </div>

                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4 select-none">GST</div>
                        <input type="text" class="inps h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl  capitalize" placeholder='GST' name="gst" value="">
                    </div>

                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4 select-none">Client Category</div>
                        <select required class="h-full select_inp client_turnover my-1 border w-3/4 px-2 rounded-xl capitalize text-slate-900" name="client_turnover">
                            <option disabled selected value="null">select client turnover</option>
                            {% for s in client_turnover %}<option value="{{s.id}}">{{s.title}}</option>{% endfor %}
                        </select> 
                    </div>

                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4 select-none">Business Category</div>
                        <select required class="select_inp business_category my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" name="business_category">
                          <option disabled selected value="null">Business Category</option>
                          {% for s in business_category %}<option value="{{s.id}}">{{s.title}}</option>{% endfor %}
                        </select>
                    </div>

                    <div class="w-full h-auto p-2 selected_program_view_dv hidden">
                        <div class="flex flex-col p-2 bg-slate-300 rounded-xl p-2">
                            <div class="text-center text-slate-900 h-[20px]">Selected Programs</div>
                            <div class="h-[calc(100%-20px)] text-slate-900">
                            <div class="btn btn-error btn-xs clear_selected_program">Clear All</div>
                                <ul class="selected_programs_view h-full w-full overflow-auto">
                                </ul>
                            </div>
                        </div>
                    </div>

                    {% comment %} <div class="w-[100%] border rounded-xl p-5 my-2 bg-slate-100">
                        {% for s in segment %}
                            <span class="capitalize">{{s}}</span>
                            <div class="w-[95%] text-slate-900 bg-white rounded-lg p-2 m-3">
                                {% for sl in service_list %}
                                    {% if sl.segment.id == s.id %}
                                        <div class="my-3">
                                            <div class="text-gray-700 capitalize font-semibold m-2 ">{{sl.service}}</div>
                                            <div class="ml-5 flex w-full flex-wrap">
                                                {% for m in marketplace_list %}
                                                    {% if sl.service.id == m.service.id %}
                                                        <div class="capitalize mx-2 text-gray-500 w-1/4"><label><input data-segment="{{s.id}}" data-service="{{sl.service.id}}" data-marketplace="{{m.marketplace.id}}" class="inp service checkbox_inp" type="checkbox" name="service" value="{{m.id}}" id="service{{forloop.counter}}" ><span class="ml-2">{{m.marketplace}}</span></label></div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div> {% endcomment %}

                    <div class="w-[100%] user_program_dv bg-slate-100 text-slate-900 user_service_dv flex h-[400px]" data-name="program" >
                        {% for d in dropdown_data %}
                            {% for key,value in d.items %}
                                <div class="flex-1 border {{key}}_container {% if key != 'segment' %}invisible{% endif %}">
                                    <div class="flex justify-center my-2">
                                        <div class="btn btn-warning btn-xs select_all_{{key}}">Select All {{key}}</div>
                                    </div>
                                    <div class="overflow-x-auto">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    {% if data != 'no data' %}
                                                        {% if key == 'segment' %}
                                                            <th class="p-1">Segment</th>
                                                        {% endif %}
                                                        {% if key == 'service' %}
                                                            <th class="p-1">Service</th>
                                                        {% endif %}
                                                        {% if key == 'marketplace' %}
                                                            <th class="p-1">Marketplace</th>
                                                        {% endif %}
                                                        {% if key == 'program' %}
                                                            <th class="p-1">Program</th>
                                                        {% endif %}
                                                </tr>
                                                    {% else %}
                                                        <div class="h-12 flex justify-center items-center bg-gray-200">no data</div>
                                                    {% endif %}
                                            </thead>
                                            <tbody class="text-xs">                                                    
                                                {% if data != 'no data' %}
                                                    {%for d in value%}
                                                        <tr class="border-b border-slate-200 shadow-sm hover:shadow-md">
                                                            {% if key == 'segment' %}
                                                                <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-id="{{d.id}}" >{{d.segment|customreplacespace:"_"}}</td>
                                                            {% elif key == 'service' %}
                                                                <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-segment-id="{{d.segment.id}}", data-id="{{d.id}}">{{d.service|customreplacespace:"_"}}</td>                                                    
                                                            {% elif key == 'marketplace' %}
                                                                <td class="p-1 capitalize cursor-pointer {{key}}_item" data-type="{{key}}" data-service-id="{{d.service.id}}" data-id="{{d.id}}"  data-id="{{d.data}}">{{d.marketplace|customreplacespace:"_"}}</td>
                                                            {% elif key == 'program' %}
                                                                <td class="edit_{{key}} p-1 capitalize cursor-pointer {{key}}_item flex justify-between" data-type="{{key}}" data-marketplace-id="{{d.marketplace.id}}" data-id="{{d.id}}">
                                                                    <span>{{d.program|customreplacespace:"_"}}</span> 
                                                                    <button data-id="{{d.id}}" class="selectedProgramBtn btn btn-xs btn-success text-white">Select</button>
                                                                    <button data-id="{{d.id}}" class="removeProgramBtn hidden btn btn-xs btn-error text-white">Remove</button>
                                                                </td>
                                                            {% endif %}
                                                        </tr>
                                                    {% endfor %}
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>


                        

                </div>
                <button class="inps w-full create_lead_manually btn btn-success text-white">Submit</button>
                `

                {% for d in dropdown_data %}
                    {% for key,value in d.items %}
                        // console.log(`d {{key}}`);
            
            
                            const select_all_{{key}} = popup.querySelector('.select_all_{{key}}')
                            select_all_{{key}}.addEventListener('click', ()=>{
                                let dataList;
            
                                {% if key == 'segment' %}

                                    dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                                    
                                {% elif key == 'service' %}
            
                                    dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.segment.id===Number(selectedSegment)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                                
                                {% elif key == 'marketplace' %}
            
                                    console.log('selected service', selectedService);
                                
                                    dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.service.id===Number(selectedService)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                                
                                {% elif key == 'program' %}
                                
                                    dataList = [main_dropdown_data.filter(e=>e.table === 'program')[0]?.value.filter(e=>e.marketplace.id===Number(selectedMarketplace)).map(e=> {if(!selected_programs_list.includes(e.program.id)) return e.program.id }).filter(e=> e!=='' && e!==null && e !== undefined) ];
                                
                                {% endif %}
            
                                if (dataList[0].length > 0 ){
                                    dataList[0].forEach(e=>{
                                        selected_programs_list.push(e)
                                    })
                                    selectedProgramsViewFunc(dataList[0])
                                }
            
                            })
            
            
            
                            const {{key}}_item = document.querySelectorAll('.{{key}}_item')
                            {{key}}_item.forEach(e=>{
                                e.addEventListener('click', ()=>{
                                    highlighter({{key}}_item, e)
                                    let containers = defineContainers();
                                    
                                    {% if key == 'segment' %}

                                    
                                    if (containers.service.classList.value.includes('invisible')){
                                        containers.service.classList.remove('invisible');
                                    }

                                        containers.marketplace.classList.add('invisible');
                                        containers.program.classList.add('invisible');
                                        const service_list = document.querySelectorAll('.service_item');
                                        service_list.forEach(f=>{
                                            f.parentElement.classList.add('hidden');
                                        })



                                        service_list.forEach(f=>{
                                            if (Number(f.getAttribute('data-segment-id')) === Number(e.getAttribute('data-id'))){
                                                f.parentElement.classList.remove('hidden');

                                            }
                                        })

                                        console.log('segment select working')
            
                                        selectedSegment = e.getAttribute('data-id');
            
                                    {% elif key == 'service' %}
                                        if (containers.marketplace.classList.value.includes('invisible')){
                                            containers.marketplace.classList.remove('invisible');
                                        }
                                        containers.program.classList.add('invisible');
                                        const marketplace_list = document.querySelectorAll('.marketplace_item');
                                        marketplace_list.forEach(f=>{
                                            f.parentElement.classList.add('hidden');
                                        })
                                        marketplace_list.forEach(f=>{
                                            if (Number(f.getAttribute('data-service-id')) === Number(e.getAttribute('data-id'))){
                                                f.parentElement.classList.remove('hidden');
                                            }
                                        })
                                        selectedService = e.getAttribute('data-id');
            
                                    {% elif key == 'marketplace' %}
                                        if (containers.program.classList.value.includes('invisible')){
                                            containers.program.classList.remove('invisible');
                                        }
                                        const program_list = document.querySelectorAll('.program_item');
                                        program_list.forEach(f=>{
                                            f.parentElement.classList.add('hidden');
                                        })
                                        program_list.forEach(f=>{
                                            if (Number(f.getAttribute('data-marketplace-id')) === Number(e.getAttribute('data-id'))){
                                                f.parentElement.classList.remove('hidden');
                                            }
                                        })
                                        selectedMarketplace = e.getAttribute('data-id');
            
                                    {% endif  %}
                                })
                            })

                    {% endfor %}
                {% endfor %}


                const clear_selected_program = document.querySelector('.clear_selected_program');
                clear_selected_program.addEventListener('click', clearSelectedProgram )
        
                const selectedProgramBtn = document.querySelectorAll('.selectedProgramBtn');
                {% comment %} const removeProgramBtn = document.querySelectorAll('.removeProgramBtn'); {% endcomment %}
                selectedProgramBtn.forEach((e, i)=>{
                    e.addEventListener('click',(f)=>{
                        f.preventDefault()
                        selected_programs_list.push(Number(e.getAttribute('data-id')));
                        e.classList.add('hidden')
                        // removeProgramBtn[i].classList.remove('hidden')
                        selectedProgramsViewFunc([Number(e.getAttribute('data-id'))]);
                    })
                })


                async function cnf(type, tar){
                    let programListView = [];
                    const check_inp = document.querySelectorAll('.check_inp');
                    const inps = document.querySelectorAll('.inps');
                    const select_inp = document.querySelectorAll('.select_inp');
                    const service = document.querySelectorAll('.service');
                    const country_code = document.querySelector('.country_code');
                    data = {}
                    check_inp.forEach(e=>{
                        data[e.name] = e.checked
                    })

                    data['program'] = selected_programs_list;
                    url = '{% url "create_lead_manual" %}';
                    method = 'POST'
                    // data['service'] = Array.from(service).filter(e=>e.checked).map(e=> ({'segment': Number(e.getAttribute('data-segment')), 'service': Number(e.getAttribute('data-service')), 'marketplace': Number(e.getAttribute('data-marketplace'))}))
                    inps.forEach(e=>{
                        if (e.name === 'phone_number') {
                            data[e.name] = e.value !== ''?`${country_code.value} ${e.value}`:null 
                        } else {
                            data[e.name] = e.value !== ''?e.value:null 
                        }
                    })
                    // console.log('data (()))(()))(()))(()))', data)
                    let a = await ftN('{% url "create_lead_manual" %}', 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){poperFunction(a.status,a.message, a.status===200?true:false)}

                    // let empId = null;
                    // let reporting_manager;
                    // let user_role;
                    // let employee_status;
                    // let programListView = [];
                    // let url;
                    // let method;
                    // const service = document.querySelectorAll('.service');
                    // const inps = document.querySelectorAll('.inps')
                    // data = {}
                    // inps.forEach((e,i)=>{
                    //     if (e.localName === 'input'){
                    //         if (e.type === 'text'){
                    //             if (e.name === 'reporting_manager'){
                    //                 reporting_manager = e.value;
                    //                 data[e.name] = Number(e.getAttribute('data-id')) === 0 ? null : Number(e.getAttribute('data-id'));
                    //             } else {
                    //                 data[e.name] = e.value
                    //             }
                    //         }
                    //         if (e.type === 'checkbox'){
                    //             const checkbox = document.querySelectorAll(`.${e.name}`)
                    //             const checked_data = []
                    //             checkbox.forEach(e=>{
                    //                 if (e.checked){
                    //                     checked_data.push(e.value)
                    //                 }
                    //             })
                    //             data[e.name] = checked_data
                    //         }
                    //     }
                    // })
                    // inps.forEach(e=>{
                    //     if (e.localName === 'select'){
                    //         if (e.name === 'user_role'){
                    //             user_role = e.selectedOptions[0].innerText;
                    //         } 
                    //         if (e.name === 'employee_status'){
                    //             employee_status = 'none'
                    //             data[e.name] = null
                    //         } else {
                    //             data[e.name] = Number(e.value)
                    //         }
                    //     }
                    // })

                    main_dropdown_data.forEach(e=>{
                        if (e.table==='program'){
                            e.value.forEach(f=>{
                                console.log(f);
                                if ( data.program.includes(f.program.id) ) {
                                    programListView.push(`${f.segment.value} > ${f.service.value} > ${f.marketplace.value} > ${f.program.value}`)
                                }
                                
                            })
                        }
                    })

                    // const popup = document.createElement('div');
                    // popup.classList.value = 'popup h-96 w-96 fixed top-[50%] left-[50%] shadow-2xl bg-slate-200 translate-y-[-50%] translate-x-[-50%] rounded-xl overflow-hidden border border-slate-500 border-solid';
                    // popup.innerHTML = `
                    //     <div class="h-[30px] w-full flex" >
                    //         <div class=" h-full w-[calc(100%-30px)] bg-slate-700">
                    //             <div class="h-full text-white capitalize flex justify-center items-center">Confirmation</div>
                    //         </div>
                    //         <div class=" h-full w-[30px] bg-red-500" onclick="cPP(event)" >
                    //             <img src="/static/assets/images/close_button.png">
                    //         </div>
                    //     </div>
                    //     <div class="h-[calc(100%-80px)] p-2 text-xs">
                    //         <div class="h-2/4">
                    //             <div class="flex"><div class="w-[35%]">Name</div><div class="w-[65%]">${data.name}</div></div>
                    //             <div class="flex"><div class="w-[35%]">Mobile Number</div><div class="w-[65%]">${data.mobile_number}</div></div>
                    //             <div class="flex"><div class="w-[35%]">Email</div><div class="w-[65%]">${data.email}</div></div>
                    //             <div class="flex"><div class="w-[35%]">Reporting Manager</div><div class="w-[65%]">${reporting_manager}</div></div>
                    //             <div class="flex"><div class="w-[35%]">User Role</div><div class="w-[65%]">${user_role}</div></div>
                    //             <div class="flex"><div class="w-[35%]">Employee Status</div><div class="w-[65%]">${employee_status}</div></div>
                    //         </div>
                    //         <div class="h-2/4 bg-slate-300 rounded-xl shadow-xl p-3 overflow-auto">
                    //             <ul >
                    //                 ${programListView.map(e=> `<li class="text-nowrap h-7">${e}</li>`).join('')}
                    //             </ul>
                    //         
                    //         </div>
                    //     </div>
                    //     <div class="h-[50px] w-full flex justify-center items-center">
                    //         <button class="btn btn-xs btn-success text-white capitalize confirm">${type}</button>
                    //     </div>
                    // `
                    // document.body.append(popup);
                    //  popup.querySelector('.confirm').onclick = async function (){
                    //     let a = await ftN(url, method, {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    //     if (a){
                    //         poperFunction(a.status,a.message, a.status===200?true:false)
                    //     }
                    //  }
                     

                }
        



                const create_lead_manually = document.querySelector('.create_lead_manually')
                if (create_lead_manually){
                    create_lead_manually.addEventListener('click', async ()=>{
                        console.log('create_lead_manually',create_lead_manually)
                        cnf('create', null)
                    //     const check_inp = document.querySelectorAll('.check_inp');
                    //     const inps = document.querySelectorAll('.inps');
                    //     const select_inp = document.querySelectorAll('.select_inp');
                    //     const service = document.querySelectorAll('.service');
                    //     const country_code = document.querySelector('.country_code');
                    //     data = {}
                    //     check_inp.forEach(e=>{
                    //         data[e.name] = e.checked
                    //     })
                    //     data['service'] = Array.from(service).filter(e=>e.checked).map(e=> ({'segment': Number(e.getAttribute('data-segment')), 'service': Number(e.getAttribute('data-service')), 'marketplace': Number(e.getAttribute('data-marketplace'))}) )
                    //     inps.forEach(e=>{
                    //         if (e.name === 'phone_number') {
                    //             data[e.name] = e.value !== ''?`${country_code.value} ${e.value}`:null 
                    //         } else {
                    //             data[e.name] = e.value !== ''?e.value:null 
                    //         }
                    //     })
                    //     let a = await ftN('{% url "create_lead_manual" %}', 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    //     if (a){poperFunction(a.status,a.message, a.status===200?true:false)}
                    })
                }


{% if request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}

            }

        })
    })
    
    uploadEvents()

{% endif %}

})



const follow_up_history = document.querySelectorAll('.follow_up_history');
follow_up_history.forEach(e=>{
    e.addEventListener('click', async ()=>{

        let url = '{% url "lead_related_services" client_id=0 %}'.replaceAll(0, e.getAttribute('data-client-id'));
        let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

        const popup = document.createElement('div');
        popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50'
        popup.innerHTML = `
            <div class="w-[600px] h-[500px] bg-white rounded-2xl">

                <div class="card w-[600px] h-[500px] bg-white text-neutral-content overflow-hidden">
                    <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Follow Up History</div>
                        <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                    <div class="h-[40px] flex justify-between items-center text-white px-4 border-b bg-gray-200">
                        <div class="text-slate-900 font-bold">List of follow up</div>
                        {% comment %} <label class="flex justify-center text-slate-900"><span>Edit</span><input type="checkbox" class="edit_toggle toggle ml-3" /><label> {% endcomment %}
                    </div>
                        <div class="main_container h-[calc(100%-100px)] w-full flex justify-between flex-wrap p-3 overflow-y-scroll text-slate-900 bg-gray-50">

                            <div class="overflow-x-auto">
                                <table class="table table-zebra">
                                    <!-- head -->
                                    <thead>
                                      <tr>
                                        <th class="text-xs">Service</th>
                                        <th class="text-xs">Date</th>
                                        <th class="text-xs">Time</th>
                                        <th class="text-xs">Notes</th>
                                        <th class="text-xs">Updated By</th>
                                      </tr>
                                    </thead>
                                    <tbody class="table_body">
                                    </tbody>
                            </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `
        document.body.append(popup)

        if (a){

            const main_container = document.querySelector('.main_container');
            const table_body = document.querySelector('.table_body');
            const keys =  Object.keys(a.data[0])
            
            a.data.forEach(e=>{
                e.follow_up.forEach(f=>{
                    const tr = document.createElement('tr')
                    tr.innerHTML = `
                    <td class="capitalize text-xs" >${e.service.value}</td>
                    <td class="capitalize text-xs" >${f.date}</td>
                    <td class="capitalize text-xs" >${f.time}</td>
                    <td class="capitalize text-xs" >${f.notes}</td>
                    <td class="capitalize text-xs" >${f.created_by}</td>
                    `
                    table_body.append(tr)  
                })
            })
        }


        const close_btn = popup.querySelectorAll('.close_btn');
        close_btn.forEach(e=>{
            e.addEventListener('click',()=>{
                popup.remove()
            })
        })
        
    })
})



{% comment %} {% if request.user|role_validity:'business_development_associate' or request.user|role_validity:'business_development_team_lead' %} {% endcomment %}

async function emailProposal(e, followUpCreation, btnEventsFun) {

    const button_heading = document.querySelector('.button_heading');
    button_heading.innerText="Email Proposal"

        const content_l2 = document.querySelector('.content_l2')
        content_l2.innerHTML = `
            <div class="rounded-2xl w-full h-full flex justify-center items-center">
                <div class="card w-full h-full text-neutral-content overflow-hidden">

                    {% comment %} <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Proposal Email</div> {% endcomment %}
                        {% comment %} <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}"> {% endcomment %}
                
                        <div class="main_container h-[calc(100%)] w-full flex justify-between flex-wrap text-slate-900 bg-gray-50">
                            <div class="main_container_inr w-full h-full flex justify-center">
                                <div class="h-auto w-full flex justify-start flex-col bg-gray-50 text-slate-900 text-xs">
                                    {% csrf_token %}


                                    <div class="w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Segment</div>
                                        <select class="inps select_inp segment my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Segment" name="segment">
                                            <option disabled selected value="null">Select Segment</option>

                                            {% for d in dropdown_data %}
                                                {% for s in d.segment %}
                                                    <option value="{{s.id}}">{{s}}</option>
                                                {% endfor %}
                                            {% endfor %}
                                    


                                        </select>
                                    </div>
                                    <div class="w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Service</div>
                                        <select disabled class="inps select_inp service my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Service" name="service">
                                            <option disabled selected value="null">Select Service</option>
                                        </select>
                                    </div>
                                    <div class="w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Marketplace</div>
                                        <select disabled class="inps select_inp marketplace my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Marketplace" name="marketplace">
                                            <option disabled selected value="null">Select Marketplace</option>
                                        </select>
                                    </div>
                                    <div class="w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Program</div>
                                        <select data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} disabled class="inps select_inp program my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Program" name="program">
                                            <option disabled selected value="null">Select Program</option>
                                        </select>
                                    </div>
                                    <div class="w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Commercial</div>
                                        <select disabled class="inps select_inp commercial my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Commercial" name="commercial">
                                            <option disabled selected value="null">Select Commercial</option>
                                        </select>
                                    </div>
                                    <div class="custom_commercial_main_dv hidden w-[100%] h-10 flex my-1 ">
                                        <div class="flex items-center h-full w-1/4">Custom Commercial</div>
                                        <input type="text" class="custom_commercial h-full w-3/4 my-1 text-slate-900 border flex px-2 rounded-xl capitalize" placeholder='Custom Commercial' name="custom_commercial" value="">
                                    </div>

                                    <button data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="send_proposal_email w-full my-3 btn btn-success text-white">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`

            btnEventsFun()


            const segment = document.querySelector('.segment');
            const service = document.querySelector('.service');
            const marketplace = document.querySelector('.marketplace');
            const program = document.querySelector('.program');
            const commercial = document.querySelector('.commercial');

            
            interDependentFields(segment, service, 'segment', 'service')
            interDependentFields(service, marketplace, 'service', 'marketplace')
            interDependentFields(marketplace, program, 'marketplace', 'program')
            {% comment %} interDependentFields(service, marketplace, 'service', 'marketplace') {% endcomment %}


            program.addEventListener('change',async()=>{
                if (commercial.disabled){
                    commercial.disabled = false
                }
                // commercial.innerHTML = ''

                let url = '{% url "commercial_list" lead_id="*" marketplace_id="**" program_id="***" %}'.replaceAll("***",program.value).replaceAll("**",marketplace.value).replaceAll("*", program.getAttribute('data-lead-id'));
                let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, '')
                if (a){
                    if (a.status===200){
                        const commercial = document.querySelector('.commercial');
                        a.data.forEach(e=>{
                            const opt = document.createElement('option')
                            opt.value = e.id
                            opt.innerText = e.value
                            commercial.append(opt)
                        })

                        const opt = document.createElement('option'); opt.value = null; opt.innerText = 'others'; commercial.append(opt)
                    } else {
                        poperFunction(a.status, a.message, false)
                    }
                
                }
            })  

            // const commercial = document.querySelector('.commercial');
            // a.data.forEach(e=>{
            //     const opt = document.createElement('option');
            //     opt.value = Number(e.id)
            //     opt.innerText = e.value
            //     commercial.append(opt)
            // })



            commercial.addEventListener('change',()=>{
                console.log('working')
                const custom_commercial_main_dv = document.querySelector('.custom_commercial_main_dv');
                if (commercial.selectedOptions[0].innerText.toLocaleLowerCase() === 'others' ) {
                    custom_commercial_main_dv.classList.remove('hidden')
                } else {
                    custom_commercial_main_dv.classList.add('hidden')
                }
            })

            const send_proposal_email = document.querySelector('.send_proposal_email');
            send_proposal_email.addEventListener('click', async ()=>{
                console.log('commercial.value', commercial.value)
                // if (commercial.value !== 'null'){
                    let data = {}
                    // const commercial = document.querySelector('.commercial');
                    const custom_commercial = document.querySelector('.custom_commercial');
                    if (commercial.selectedOptions[0].innerText.toLocaleLowerCase() !== 'others' ) {
                        data['commercial_id'] = Number(commercial.value)
                        data['client_id'] = send_proposal_email.getAttribute('data-client-id')
                        data['lead_id'] = send_proposal_email.getAttribute('data-lead-id')

                    } else {
                        data['commercial_id'] = null
                        data['lead_id'] = send_proposal_email.getAttribute('data-lead-id')
                        data['client_id'] = send_proposal_email.getAttribute('data-client-id')
                        data['custom_commercial'] = custom_commercial.value
                    }
                    let url = '{% url "email_proposal" %}';
                    let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){
                        if (a.status === 200){
                            poperFunction(a.status,a.message,false)
                            followUpCreation({'follow_up_type': 'follow_up_proposal_sent'})
                            popup.remove()
                        } else {
                            poperFunction(a.status,a.message,false)
                        }
                    }
                // } else {
                //     poperFunction(400, 'select commercial first', false)
                // }
            })
}


const assign_associate = document.querySelectorAll('.assign_associate');
assign_associate.forEach(e=>{
    e.addEventListener('click',async()=>{

        let url = '{% url "employee_list" attribute="team_member" %}'
        let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

        if (a.status === 200 || a.status === 204 ){
            const popup = document.createElement('div');
            popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50'
            popup.innerHTML = `
                <div class="w-96 h-60 bg-white rounded-2xl">

                    <div class="card w-96 h-60 bg-white text-neutral-content overflow-hidden">
                        <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Assign Associate</div>
                            <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                        
                            <div class="main_container h-[calc(100%-35px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                                <div class="main_container_inr w-full h-full">

                                    <div class="h-full w-full flex justify-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">

                                        {% csrf_token %}

                                        <div class="w-[100%] h-10 flex my-1 ">  
                                            <div class="flex items-center h-full w-1/4">Select Associate</div>
                                            <select class="inps select_inp assign_associate_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Associate" name="associate">
                                                <option disabled selected value="null">select Associate</option>
                                            </select>
                                        </div>

                                        <button data-lead-id=${e.getAttribute('data-lead-id')} class="assign_associate_submit w-full my-3 btn btn-success text-white">Submit</button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `
            document.body.append(popup)

            const close_btn = popup.querySelectorAll('.close_btn');
            close_btn.forEach(e=>{
                e.addEventListener('click',()=>{
                    popup.remove()
                })
            })

            if (a.status !== 204){
                if (a.data.data.length > 0 ){
                    const assign_associate_select = document.querySelector('.assign_associate_select');
                    a.data.data.forEach(e=>{
                        const opt = document.createElement('option');
                        opt.value = Number(e.id)
                        opt.innerText = e.value
                        assign_associate_select.append(opt)
                    })
                }

                const assign_associate_submit = document.querySelector('.assign_associate_submit');
                assign_associate_submit.addEventListener('click',async()=>{
                data = {}
                const assign_associate_select = document.querySelector('.assign_associate_select');
                data['lead_id'] = assign_associate_submit.getAttribute('data-lead-id');
                data['user_id'] = Number(assign_associate_select.value)
                let url = '{% url "assign_associate" %}';
                let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data) )
                    if(a){
                        poperFunction(a.status,a.message, a.status===200?true:false)
                    }
                })
            }


        }
    })
})

const status_update = document.querySelectorAll('.status_update');
status_update.forEach(e=>{  
    e.addEventListener('click',async ()=>{


        let url = '{% url "lead_status_list" %}'
        let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
    
        if (a){
            const popup = document.createElement('div');
            popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center z-50'
            popup.innerHTML = `
                <div class="w-96 h-60 bg-white rounded-2xl">
    
                    <div class="card w-96 h-60 bg-white text-neutral-content overflow-hidden">
                        <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Status Update</div>
                            <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                        
                            <div class="main_container h-[calc(100%-35px)] w-full flex justify-between flex-wrap p-2 text-slate-900 bg-gray-50">
                                <div class="main_container_inr w-full h-full">
    
    
                                    <div class="h-full w-full flex justify-center flex-wrap p-3 bg-gray-50 text-slate-900 text-xs">
    
                                        {% csrf_token %}
    
                                        <div class="w-[100%] h-10 flex my-1 ">  
                                            <div class="flex items-center h-full w-1/4">Lead Status</div>
                                            <select class="inps select_inp lead_status_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Lead Status" name="lead_status">
                                                <option disabled selected value="null">Select Status</option>
                                            </select>
                                        </div>
    
                                        <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="lead_status_submit w-full my-3 btn btn-success text-white">Submit</button>
    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            `
            document.body.append(popup)
    
            const close_btn = popup.querySelectorAll('.close_btn');
            close_btn.forEach(e=>{
                e.addEventListener('click',()=>{
                    popup.remove()
                })
            })


            const lead_status_select = document.querySelector('.lead_status_select');
            a.data.forEach(f=>{

                console.log('fff', f)
                const opt = document.createElement('option');
                opt.value = Number(f.id)
                opt.innerText = f.title.replaceAll('_',' ')
                lead_status_select.append(opt)
                if ( Number(e.getAttribute('data-selected-status-id')) === Number(f.id) ) {
                    console.log(f.title)
                    opt.selected = true
                }
            })


            const lead_status_submit = document.querySelector('.lead_status_submit');
            lead_status_submit.addEventListener('click',async()=>{
            data = {}
            const lead_status_select = document.querySelector('.lead_status_select');
            data['lead_id'] = lead_status_submit.getAttribute('data-lead-id');
            data['client_id'] = lead_status_submit.getAttribute('data-client-id');
            data['lead_status_id'] = Number(lead_status_select.value)
            let url = '{% url "lead_status_update" %}';
            let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data) )
                if(a){
                    poperFunction(a.status,a.message, a.status===200?true:false)
                }
            })
        }
        
    })
})

const initiate_call = document.querySelectorAll('.initiate_call');

    async function getLeadHistory(lead_id) {
        let url = '{% url "lead_history" lead_id='0' %}'.replaceAll('0', lead_id);
        try{
            let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, '' );
            if (a){
                return a.data
            } else {
                poperFunction(a.status, a.message, false)
            }
        } catch (e) {
            console.log(e)
        }
    }

    async function createPopup(e){
        const popup = document.createElement('div');
        popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center p-10 z-50'
        popup.innerHTML = `
            <div class="w-full h-full bg-white rounded-2xl">
                <div class="card w-full h-full bg-white text-neutral-content overflow-hidden">
                    <div class="h-[35px] relative flex justify-center items-center text-white bg-slate-900">Initiate Call</div> 
                    <img class="close_btn absolute h-6 w-6 top-[5px] right-[5px] cursor-pointer" src="{% static "assets/images/close_button.png" %}">
                    <div class="card_container w-full h-[calc(100%-35px)] flex">



                        <div class="w-1/4 h-full text-xs text-slate-900 border-r p-2">
                            <div class="h-[30px] w-full flex justify-center items-center">
                                <div class="text-base">Lead Overview</div>
                            </div>  
                            <div class="p-2 h-[calc(100%-30px)] bg-slate-50 rounded-lg w-full ">
                                <div class="overflow-y-scroll h-full">
                                    <table class="table lead_view_inr">
                                    </table>
                                </div>
                            </div>
                        </div>



                        <div class="w-2/4 h-full flex flex-col p-2 ">
                            <div class="h-[60px] w-full rounded-lg flex justify-center items-center heading_cont">
                            </div>
                            <div class="card_container_l1 h-[calc(100%-60px)] bg-slate-50 rounded-lg w-full">
                            </div>
                        </div>


                        
                        <div class="h-full w-1/4 text-xs text-slate-900 border-l p-1">
                            <div class="h-[30px] w-full rounded-lg flex justify-center items-center">
                                <div class="text-base">Timeline</div>
                            </div>
                            <div class="p-2 bg-slate-50 h-[calc(100%-30px)]  rounded-lg w-full">
                                <div class="overflow-y-scroll h-full">
                                    <div class="h-full w-full history_container timeline timeline-vertical">
                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>
        `

        let lead_data = {
            lead_id : e.getAttribute("data-lead-id"),
            client_id : e.getAttribute("data-client-id"),
            client_name : e.getAttribute("data-client-name"),
            email_id : e.getAttribute("data-email-id"),
            contact_number : e.getAttribute("data-contact-number"),
            business_name : e.getAttribute("data-business-name"),
            brand_name : e.getAttribute("data-brand-name"),
            gst : e.getAttribute("data-gst"),
            seller_address : e.getAttribute("data-seller-address"),
            payment_model : e.getAttribute("data-payment-model"),
            payment_terms : e.getAttribute("data-payment-terms"),
            mou_required : e.getAttribute("data-mou-required"),
            comments : e.getAttribute("data-comments"),
            segment : e.getAttribute("data-segment"),
            service : e.getAttribute("data-service"),
            marketplace : e.getAttribute("data-marketplace"),
            program : e.getAttribute("data-program"),
        }


        const lead_view_inr = popup.querySelector('.lead_view_inr');
        for (let key in lead_data){
            lead_view_inr.innerHTML += `
                <tr class="bg-none text-xs">
                    <td class="p-1 capitalize font-bold" >${key.replaceAll("_", " ")}</td>
                    <td class="p-1 capitalize" >${lead_data[key]}</td>
                </tr>
            `
        }


            const history_container = popup.querySelector('.history_container');
            let leadHistoryData = await getLeadHistory(e.getAttribute('data-lead-id'));
            console.log('leadHistoryData ',leadHistoryData)
            if (leadHistoryData){
                let a = {};

                    if (leadHistoryData.length > 0) {

                        leadHistoryData.forEach(e=>{

                            history_container.innerHTML += `

                                <div class="card ${ 
                                    e.action_type === 'created' 
                                    ? 'bg-cyan-200' 
                                    : e.action_type === 'status_update' 
                                        ? 'bg-green-200' 
                                        : e.action_type === 'follow_up' 
                                            ? 'bg-amber-200' 
                                            : e.action_type === 'email_proposal' || e.action_type === 'email_asked_for_details' || e.action_type === 'email_mou' 
                                                ? 'bg-pink-200' 
                                                : e.action_type === 'updated'
                                                    ? 'bg-teal-200' 
                                                    : e.action_type === 'assigned'
                                                        ? 'bg-blue-200' 
                                                        : e.action_type === 'reassigned' 
                                                            ? 'bg-sky-200' 
                                                            : e.action_type === 'commercial_sent_for_approval'
                                                                ? 'bg-orange-200' 
                                                                : e.action_type === 'commercial_approved' 
                                                                    ? 'bg-lime-200' 
                                                                    : e.action_type === 'commercial_rejected' 
                                                                        ? 'bg-red-200' 
                                                                        : e.action_type === 'mou_sent_for_approval' || 'payment_proof_sent_for_approval' 
                                                                            ? 'bg-purple-200' 
                                                                            : 'bg-white'
                                        } w-full shadow-xl my-2 p-2">
                                    <div class=" w-full">
                                        <div class="flex justify-between items-center">
                                            <div class="text-xs w-[60%] capitalize font-medium p-1">${e.title.replaceAll('_', ' ')}</div>
                                            <div class="text-[9px] ml-3 w-[40%] font-medium">${e.date.split('.')[0] }</div>
                                        </div>
                                        ${ e.field &&
                                            e.field.length>0 ? 
                                            e.field.map(f=>{ 


                                                if (e.action_type === 'updated' || e.action_type === 'assigned' || e.action_type === 'reassigned'  ){
                                                return `
                                                    <ul class="p-2 m-1 bg-slate-50 rounded-xl text-xs">
                                                        <li class="mx-1 capitalize font-semibold ">${f.key.replaceAll('_',' ')}</li>
                                                        <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Old:</div><div>${f.previous}</div></li>
                                                        <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">New:</div><div>${f.new}</div></li>
                                                    </ul>
                                                    `

                                                } else if (e.action_type === 'email_proposal' || e.action_type === 'email_asked_for_details' || e.action_type === 'email_mou' ){
                                                    return `
                                                        <ul class="p-2 m-1 bg-slate-50 rounded-xl text-xs">
                                                            <li class="mx-1 capitalize font-semibold ">${f.email}</li>
                                                        </ul>
                                                    `
                                                } else if (e.action_type === 'mou_sent_for_approval' || e.action_type === 'payment_proof_sent_for_approval' ){
                                                    return `
                                                        <ul class="p-2 m-1 bg-slate-50 rounded-xl text-xs">
                                                            <li class="mx-1 capitalize font-semibold ">${f.title}</li>
                                                        </ul>
                                                    `
                                                } else if (e.action_type === 'commercial_sent_for_approval' ){
                                                    return `
                                                        <ul class="p-2 m-1 bg-slate-50 rounded-xl text-xs">
                                                            <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Sent To:</div><div>${f.sent_to}</div></li>
                                                            <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Commercial:</div><div>${f.commercial}</div></li>
                                                        </ul>
                                                    `
                                                } else if (e.action_type === 'commercial_approved' || e.action_type === 'commercial_rejected' ){
                                                    return `
                                                        <ul class="p-2 m-1 bg-slate-50 rounded-xl text-xs">
                                                            <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Commercial:</div><div>${f.commercial}</div></li>
                                                        </ul>
                                                    `
                                                }
                                                }).join('')
                                            : ` ${ e.action_type === 'status_update' ? `<ul class="p-2 text-xs m-1 bg-slate-50 rounded-xl">
                                                    <li class="mx-1 capitalize">${e.status.replaceAll('_', ' ')}</li>
                                                </ul>` : e.action_type == 'follow_up' ? `<ul class="p-2 text-xs m-1 bg-slate-50 rounded-xl">
                                                        <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Date:</div><div>${e.followup_date}</div></li>
                                                        <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Time:</div><div>${e.followup_time}</div></li>
                                                        <li class="mx-3 text-wrap flex"><div class="mr-2 font-medium">Notes:</div><div>${e.notes}</div></li>
                                                </ul>` : ''  }
                                                `
                                        }
                                        <div class="border-t border-b border-white flex mx-3 p-1 my-1"> <div class="mr-1">by: </div><div class="capitalize" >${e.updated_by}</div></div>
                                    </div>
                                </div>
                            `
                        })
                    }
            }

        return popup
    }

initiate_call.forEach(e=>{
    
    e.addEventListener('click', async ()=>{


        if (e.getAttribute('data-status') === 'assign_associate_pending' ){

            const popup = await createPopup(e);
            const heading = popup.querySelector('.heading_cont');
            heading.innerHTML = `
                <ul class="steps text-slate-900 w-full text-xs">
                    <li data-name="duration" class="step">Duration</li>
                    <li data-name="associate" class="step">Associate</li>
                </ul>
            `;
            document.body.append(popup)


            const exemptPayment = ['amazon paid', 'flipkart paid', 'foc'];
            const card_container_l1 = popup.querySelector('.card_container_l1');

            // if (exemptPayment.includes(e.getAttribute('data-paid-by')) ){
            // card_container.querySelectorAll('.step').forEach(e=>{
                // if (e.getAttribute('data-name') === 'payment_proof'){
                //     e.remove();
                // }
            // })
            serviceDuration(card_container_l1);
            // } else {
                // paymentProofFunc(card_container_l1);
            // }


            function updateSteps(atr){
                const steps = document.querySelectorAll('.step');
                steps.forEach(e=>{
                    if (e.getAttribute('data-name') === atr){
                        e.classList.add('step-primary')
                    }
                })
            }                              

            function serviceDuration(par){
                updateSteps('duration');

                if (e.getAttribute('data-payment-model').trim() === 'one time' ) {
                    par.innerHTML = `
                        <div class="duration_dv h-full w-full flex flex-col justify-center items-center p-2 text-slate-900 text-xs">
                            <div class="w-[100%] h-[50px] flex my-1 items-center justify-center text-base font-bold">
                                <div>Select duration to proceed</div>
                            </div>
                            <div class="h-[calc(100%-100px)] w-full flex flex-col justify-center items-center">
                                <div class="w-[100%] h-12 flex my-1 items-center ">
                                    <div class="flex justify-center items-center h-10 w-1/4 ">Start Date</div>                                            
                                    <input type="date" data-name="subscription_start_date" class="inps select_inp start_date_select my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900">
                                </div>
                                <div class="w-[100%] h-12 flex my-1 items-center ">
                                    <div class="flex justify-center items-center h-10 w-1/4 ">End Date</div>
                                    <input type="date" data-name="subscription_end_date" class="inps select_inp end_date_select my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900">
                                </div>
                            </div>
                            <div class="w-[100%] h-[50px] flex my-1 items-center justify-center ">
                                <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-1/4 my-3 btn btn-sm btn-success text-white">Submit</button>
                            </div>
                        </div>
                    `

                    let btnDisabled = [false, false];

                    function inputHighlighter(e, i){
                        console.log('e',e, btnDisabled[i] )
                        if (btnDisabled[i]){
                            e.classList.remove('border')
                            e.classList.remove('border-red-700')
                        } else {
                            e.classList.add('border')
                            e.classList.add('border-red-700')
                        }
                    }

                    function btnEnabler(){
                        let data = [];
                        btnDisabled.forEach(e=>{
                            if (e){
                                data.push(0)
                            }
                        })
                        return data.length === 2 ? true : false;
                    }

                    par.querySelectorAll('.inps').forEach((e,i)=>{
                        let btnEnablerVar = false;
                        e.onblur = function (e) {
                            console.log('e.value', e.target.value)
                            btnDisabled[i] = e.target.value === '' || e.target.value === null ? false : true;
                            console.log('btnDisabled', btnDisabled)
                            inputHighlighter(e.target, i);
                            btnEnablerVar = btnEnabler();

                            if (btnEnablerVar){
                                par.querySelector('.actionBtn').disabled = false;
                            } else {
                                par.querySelector('.actionBtn').disabled = true;
                            }

                        }
                    })


                    par.querySelector('.actionBtn').onclick = async function (e){
                        let data = {}
                        par.querySelectorAll('.inps').forEach(e=>{
                            data[e.getAttribute('data-name')] = e.value;
                        });
                        let url = '{% url "add_subscription_duration" lead_id='*' %}'.replaceAll('*', par.querySelector('.actionBtn').getAttribute('data-lead-id') );
                        try{
                            console.log('data',data, url);
                            let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data));
                            if (a){
                                if (a.status === 200){
                                    selectAssociateFunc(par);
                                } else {
                                    poperFunction(a.status, a.message, false)
                                }
                            }
                        } catch (e){
                            console.log(e)
                        }
                    };

                } else if ( e.getAttribute('data-payment-model').trim() === 'retainership' ||  exemptPayment.includes(e.getAttribute('data-paid-by')) ) {
                    par.innerHTML = `
                        <div class="duration_dv h-full w-full flex flex-col justify-center items-center p-2 text-slate-900">
                            <div class="w-[100%] h-[50px] flex my-1 items-center justify-center text-base font-bold">
                                Select all checkbox to proceed
                            </div>

                            <div class="h-[calc(100%-50px)] w-full flex flex-col justify-center items-center">
                                <div class="h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                                    <div class="w-[100%] h-28 flex flex-col my-1 items-center text-xs ">

                                        <div>
                                            {% comment %} <div class="text-base font-bold my-4">Select all checkbox to proceed</div> {% endcomment %}
                                            <div class="h-8 flex items-center"><input type="checkbox" class="confirm_inp h-4 w-4 mr-3"><div>This service is a retainership services, paid by ${e.getAttribute('data-paid-by')}</div></div>
                                            <div class="h-8 flex items-center"><input type="checkbox" class="confirm_inp h-4 w-4 mr-3"><div>Duration not required</div></div>.
                                        </div>
                                    
                                        <div  class="flex justify-center items-center h-10 w-full ">No need to select duration, click Submit to proceed</div>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="w-[100%] h-[50px] flex my-1 items-center justify-center ">
                                <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-1/4 my-3 btn btn-sm btn-success text-white">Submit</button>
                            </div>
                        </div>
                    `

                    
                    Array.from(par.querySelectorAll('.confirm_inp')).forEach((e,i,a)=>{
                        e.onchange = function (){
                            console.log('a',a.filter(e=>e.checked))
                            if ( a.filter(e=>e.checked).length === a.length ){
                                par.querySelector('.actionBtn').disabled = false
                                par.querySelector('.actionBtn').onclick = function (e){
                                    selectAssociateFunc(par);
                                }
                            } else {
                                par.querySelector('.actionBtn').disabled = true
                            }   
                        }
                    })



                } else {
                    par.innerHTML = `
                        <div class="h-full w-full flex justify-center items-center text-slate-900">Payment model not selected for this service, please contact super admin</div>
                    `
                };
            }

            function selectAssociateFunc(par){
                updateSteps('associate')
                par.innerHTML = `
                    <div class="duration_dv h-full w-full flex flex-col justify-center items-center p-2">
                        <div class="h-[calc(100%-50px)] w-full flex flex-col justify-center items-center text-xs text-slate-900">

                            <div class="w-[100%] h-12 flex my-1 items-center ">
                                <div class="flex justify-center items-center h-10 w-1/4 ">Manager</div>                                            
                                <select data-name="reporting_manager" class="inps select_inp team_leader_select my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900">
                                    <option diasbled selected value="default">Select Reporting Manager</option>
                                    <option value="">Sanjay Singh</option>
                                </select>

                            </div>

                            <div class="w-[100%] h-12 flex my-1 items-center ">
                                <div class="flex justify-center items-center h-10 w-1/4 ">Associate</div>                                            
                                <select data-name="associate" class="inps select_inp team_member_select my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900">
                                    <option diasbled selected value="default">Select Associate</option>
                                    <option value="">Vijay Sahu</option>
                                </select>

                            </div>
                        </div>
                        <div class="w-[100%] h-[50px] flex my-1 items-center justify-center ">
                            <button data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-1/4 my-3 btn btn-sm btn-success text-white">Submit</button>
                        </div>
                    </div>
                `
                

                par.querySelector('.actionBtn').onclick = async function (e){
                    try{
                        let url = '{% url "service_associate_submit" lead_id="*" %}'.replaceAll('*',e.target.getAttribute('data-lead-id'))
                        let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, '')
                        if (a) {
                            poperFunction(a.status, a.message, a.status===200?true:false)
                        }
                    } catch (e){console.log(e);}
                };
            }



            function closePopup(){popup.remove()}
            popup.querySelector('.close_btn').onclick = closePopup;
            document.onkeyup = function (e){if (e.key === 'Escape' || e.key === 'Esc'){closePopup()};};

            
        }else {


            let main_popup = await createPopup(e);
            let heading = main_popup.querySelector('.heading_cont');
            heading.innerHTML = `<div class="flex justify-center items-center text-base text-slate-900">Actions</div>`;

            let popup = main_popup.querySelector('.card_container_l1');
            popup.innerHTML =  `

                <div class="main_container_inr w-full h-full">
                    <div class="main_button_container h-full w-full flex flex-col justify-center items-center p-3 bg-gray-50 text-slate-900 text-xs">


                        <div class="tooltip w-[30%] m-3" data-tip="Click to initiate closure procedure for seller.">
                            <button 
                                data-lead-id="${e.getAttribute('data-lead-id')}" 
                                data-client-id="${e.getAttribute('data-client-id')}"
                                data-client-name="${e.getAttribute('data-client-name')}"
                                data-email-id="${e.getAttribute('data-email-id')}"
                                data-contact-number="${e.getAttribute('data-contact-number')}"
                                data-business-name="${e.getAttribute('data-business-name')}"
                                data-brand-name="${e.getAttribute('data-brand-name')}"
                                data-gst="${e.getAttribute('data-gst')}"
                                data-seller-address="${e.getAttribute('data-seller-address')}"
                                data-commercial-id="${e.getAttribute('data-commercial-id')}"
                                data-client-designation-id="${e.getAttribute('data-client-designation-id')}"

                                data-program-id="${e.getAttribute('data-program-id')}"
                                data-program="${e.getAttribute('data-program')}"
                                data-marketplace-id="${e.getAttribute('data-marketplace-id')}"
                                data-marketplace="${e.getAttribute('data-marketplace')}"
                                data-service-id="${e.getAttribute('data-service-id')}"
                                data-service="${e.getAttribute('data-service')}"
                                data-segment-id="${e.getAttribute('data-segment-id')}"
                                data-segment="${e.getAttribute('data-segment')}"
                                data-payment-model-id="${e.getAttribute('data-payment-model-id')}"
                                data-payment-model="${e.getAttribute('data-payment-model')}"
                                data-payment-terms-id="${e.getAttribute('data-payment-terms-id')}"
                                data-payment-terms="${e.getAttribute('data-payment-terms')}"
                                data-mou-required="${e.getAttribute('data-mou-required')}"
                                data-paid-by-id="${e.getAttribute('data-paid-by-id')}"
                                data-paid-by="${e.getAttribute('data-paid-by')}"
                                data-comments="${e.getAttribute('data-comments')}"

                                class="closure btn w-full text-white bg-[#67B037]">Closure</button>
                        </div>

                        <div class="tooltip w-[30%] m-3" data-tip="Click to send proposal email to the seller.">
                            <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="email_proposal btn w-full text-white bg-[#D3983E]">Email Proposal</button>
                        </div>

                        <div class="tooltip w-[30%] m-3" data-tip="Click to raise follow up for the seller.">
                            <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="follow_up w-full btn text-white bg-[#A17AE0]">Follow Up</button>
                        </div>
                        <div class="tooltip w-[30%] m-3" data-tip="Click if seller is responding the call.">
                            <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="unresponsive w-full btn text-white bg-[#25ADC0]">Unresponsive</button>
                        </div>
                        <div class="tooltip w-[30%] m-3" data-tip="Click if seller is not interested with the service.">
                            <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="not_interested w-full btn text-white bg-[#E85252]">Not Interested</button>
                        </div>
                    </div>
                    <div class="main_content_container h-full w-full flex flex-col p-3 bg-gray-50 text-slate-900 text-xs">
                        <div class="flex items-center justify-center relative">
                            <img class="back_to_button absolute left-[20px] w-[20px] h-[20px] cursor-pointer" src="{% static "assets/images/backward_black.png" %}">
                            <h3 class="button_heading ml-4 text-lg font-bold ">Something</h3>
                        </div>
                        <div class="content_l2 h-[calc(100%-20px)] w-[100%]"></div>
                    </div>
                </div>
            `


            
            // const popup = document.createElement('div');
            // popup.classList.value = 'absolute top-0 w-screen h-screen bg-[rgba(0,0,0,0.6)] flex justify-center items-center p-10 z-50'
            // popup.innerHTML = `
            // `

            let lead_data = {
                lead_id : e.getAttribute("data-lead-id"),
                client_id : e.getAttribute("data-client-id"),
                client_name : e.getAttribute("data-client-name"),
                email_id : e.getAttribute("data-email-id"),
                contact_number : e.getAttribute("data-contact-number"),
                business_name : e.getAttribute("data-business-name"),
                brand_name : e.getAttribute("data-brand-name"),
                gst : e.getAttribute("data-gst"),
                seller_address : e.getAttribute("data-seller-address"),
                payment_model : e.getAttribute("data-payment-model"),
                payment_terms : e.getAttribute("data-payment-terms"),
                mou_required : e.getAttribute("data-mou-required"),
                comments : e.getAttribute("data-comments"),
                segment : e.getAttribute("data-segment"),
                service : e.getAttribute("data-service"),
                marketplace : e.getAttribute("data-marketplace"),
                program : e.getAttribute("data-program"),
            }

            //const lead_view_inr = popup.querySelector('.lead_view_inr');
            //lead_view_inr.innerHTML = `
            //<div class="w-full h-auto flex justify-center items-center py-3">
            //    <div class="text-lg">Lead Overview</div>
            //</div>
            // `
            //for (let key in lead_data){
            //    lead_view_inr.innerHTML += `
            //        <div class="w-full h-auto flex py-1">
            //            <div class="w-[40%] h-full font-bold">${key.replaceAll("_", " ")}</div>
            //            <div class="w-[60%] h-full">${lead_data[key]}</div>
            //        </div>
            //    `
            //}
            //
            //const lead_history_inr = popup.querySelector('.lead_history_inr');
            //lead_history_inr.innerHTML = `
            //    <div class="w-full h-auto flex justify-center items-center py-3">
            //        <div class="text-lg">Lead History</div>
            //    </div>
            //`;

            document.body.append(main_popup)


            function closePopup(){main_popup.remove()}
            main_popup.querySelector('.close_btn').onclick = closePopup;
            document.onkeyup = function (e){if (e.key === 'Escape' || e.key === 'Esc'){closePopup()};};


            const email_proposal = document.querySelector('.email_proposal');
            const closure = document.querySelector('.closure');
            const follow_up = document.querySelector('.follow_up');
            const not_interested = document.querySelector('.not_interested');
            const unresponsive = document.querySelector('.unresponsive');
            const main_button_container = document.querySelector('.main_button_container');
            const main_content_container = document.querySelector('.main_content_container');


            function btnEventsFun(){
                main_button_container.classList.add('hidden')
                main_content_container.classList.remove('hidden')

                const back_to_button = document.querySelector('.back_to_button')
                back_to_button.addEventListener('click',()=>{
                    main_button_container.classList.remove('hidden')
                    main_content_container.classList.add('hidden')
                })
            }


            function reasonSelection(lead_id, client_id, main_class){
                const content_l2 = document.querySelector('.content_l2')
                content_l2.innerHTML = `
                <div class="h-full w-full flex justify-center items-center flex-col p-3 bg-gray-50 text-slate-900 text-xs">
                    {% csrf_token %}
                    <div class="w-[100%] h-20 flex my-1 flex-col ">  
                        {% comment %} <div class="flex items-center h-10 w-[100%] text-lg font-bold justify-center">${title}</div> {% endcomment %}
                        <select class="inps select_inp ${main_class}_select my-1 border w-[100%] h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Lead Status" name="lead_status">
                            <option disabled selected value="null">Select reason</option>
                        </select>
                    </div>
                    <button data-lead-id="${lead_id}" data-client-id="${client_id}" data-table="${main_class}" class="${main_class}_submit w-full my-3 btn btn-success text-white">Submit</button>
                </div>
                `
            }

            function followUpCreation(data){
                follow_up_type = data.follow_up_type
                const button_heading = document.querySelector('.button_heading');
                button_heading.innerText="Follow Up"

                const content_l2 = document.querySelector('.content_l2')
                content_l2.innerHTML = `
                <div class="h-full w-full flex justify-center flex-col p-3 bg-gray-50 text-slate-900 text-xs">

                    {% csrf_token %}

                    <div class="w-[100%] h-10 flex my-1 ">  
                        <div class="flex items-center h-full w-1/4">Date</div>
                        <input type="date" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" name="date">
                    </div>
                    
                    <div class="w-[100%] h-10 flex my-1 ">
                        <div class="flex items-center h-full w-1/4">Time</div>
                        <input type="time" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" name="time">
                    </div>
                    
                    <div class="w-[100%] h-20 flex my-1 ">  
                        <div class="flex items-center h-full w-1/4">Notes</div>
                        <textarea class="inps my-1 p-2 border w-3/4 h-full px-2 rounded-xl text-slate-900 resize-none" name="notes"></textarea>
                    </div>

                    <button data-lead-id=${e.getAttribute('data-lead-id')} class="follow_up_submit w-full my-3 btn btn-success text-white">Submit</button>
                </div>
                `


                const main_button_container = document.querySelector('.main_button_container');
                if (!main_button_container.classList.value.includes('hidden')) { main_button_container.classList.add('hidden') }

                const follow_up_submit  = document.querySelector('.follow_up_submit');
                follow_up_submit.addEventListener('click',async()=>{
                    let data={}
                    let inps = document.querySelectorAll('.inps')
                    inps.forEach(e=>{
                        data[e.name] = e.value
                    })
                    data['client_id'] = follow_up_submit.getAttribute('data-client-id')
                    data['lead_id'] = follow_up_submit.getAttribute('data-lead-id')
                    data['follow_up_type'] = follow_up_type

                    let url = '{% url "create_followup" %}'
                    let a = await ftN(url,'POST',{'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){
                        poperFunction(a.status, a.message, follow_up_type==='follow_up'?false:true)
                    }
                })
            }


            email_proposal.addEventListener('click',(e)=>{
                emailProposal(e.target, followUpCreation, btnEventsFun)
                
            })

            closure.addEventListener('click',()=>{
                btnEventsFun()
                
                const button_heading = document.querySelector('.button_heading');
                button_heading.innerText="closure"

                const content_l2 = document.querySelector('.content_l2');
                content_l2.innerHTML = `
                <div role="tablist" class="h-[35px] tabs tabs-lifted">
                    <a role="tab"
                        data-lead-id="${closure.getAttribute('data-lead-id')}" 
                        data-client-id="${closure.getAttribute('data-client-id')}"
                        data-client-name="${closure.getAttribute('data-client-name')}"
                        data-email-id="${closure.getAttribute('data-email-id')}"
                        data-contact-number="${closure.getAttribute('data-contact-number')}"
                        data-business-name="${closure.getAttribute('data-business-name')}"
                        data-brand-name="${closure.getAttribute('data-brand-name')}"
                        data-gst="${closure.getAttribute('data-gst')}"
                        data-seller-address="${closure.getAttribute('data-seller-address')}"
                        data-commercial-id="${closure.getAttribute('data-commercial-id')}"
                        data-client-designation-id="${closure.getAttribute('data-client-designation-id')}"
                        data-program-id="${closure.getAttribute('data-program-id')}"

                        name="seller_details" class="closure_tab_button tab tab-active">Seller Details</a>

                    
                    ${closure.getAttribute('data-mou-required') === 'True' || closure.getAttribute('data-mou-required') === true ? `<a role="tab" data-lead-id="${closure.getAttribute('data-lead-id')}" data-client-id="${closure.getAttribute('data-client-id')}" name="mou" class="closure_tab_button tab">MOU</a>` : '' } 
                    {% comment %} `<a role="tab" data-lead-id="${closure.getAttribute('data-lead-id')}" data-client-id="${closure.getAttribute('data-client-id')}" name="raise_invoice" class="closure_tab_button tab">Raise Invoice</a>`  {% endcomment %}

                    <a role="tab" 
                        data-lead-id="${closure.getAttribute('data-lead-id')}" 
                        data-client-id="${closure.getAttribute('data-client-id')}" 
                        data-program-id="${closure.getAttribute('data-program-id')}"
                        data-program="${closure.getAttribute('data-program')}"
                        data-program-id="${e.getAttribute('data-program-id')}"
                        data-program="${e.getAttribute('data-program')}"
                        data-marketplace-id="${e.getAttribute('data-marketplace-id')}"
                        data-marketplace="${e.getAttribute('data-marketplace')}"
                        data-service-id="${e.getAttribute('data-service-id')}"
                        data-service="${e.getAttribute('data-service')}"
                        data-segment-id="${e.getAttribute('data-segment-id')}"
                        data-segment="${e.getAttribute('data-segment')}"
                        data-payment-model-id="${e.getAttribute('data-payment-model-id')}"
                        data-payment-model="${e.getAttribute('data-payment-model')}"
                        data-payment-terms-id="${e.getAttribute('data-payment-terms-id')}"
                        data-payment-terms="${e.getAttribute('data-payment-terms')}"
                        data-mou-required="${e.getAttribute('data-mou-required')}"
                        data-paid-by-id="${e.getAttribute('data-paid-by-id')}"
                        data-paid-by="${e.getAttribute('data-paid-by')}"
                        data-comments="${e.getAttribute('data-comments')}"


                        name="payment" class="closure_tab_button tab">Payment</a>
                </div>
                <div class="content_l3 h-[calc(100%-35px)] bg-white">

                </div>
                `

                console.log('mou_required', closure.getAttribute('data-mou-required'));


                function closureButtonAuto(){
                    const content_l3 = document.querySelector('.content_l3');
                    content_l3.innerHTML = `
                    <div class="h-full w-full flex flex-col">
                        <div class=" h-[50px] w-full border-r flex items-center justify-evenly px-1 border-b">
                            <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="ask_for_details w-[40%] my-3 create_lead_manually btn btn-sm text-white bg-[#67B037]">Ask For Details (email)</button>
                            <button 
                                data-lead-id="${e.getAttribute('data-lead-id')}" 
                                data-client-id="${e.getAttribute('data-client-id')}" 
                                data-client-name="${e.getAttribute('data-client-name')}"
                                data-email-id="${e.getAttribute('data-email-id')}"
                                data-contact-number="${e.getAttribute('data-contact-number')}"
                                data-business-name="${e.getAttribute('data-business-name')}"
                                data-brand-name="${e.getAttribute('data-brand-name')}"
                                data-gst="${e.getAttribute('data-gst')}"
                                data-seller-address="${e.getAttribute('data-seller-address')}"
                                data-commercial-id="${e.getAttribute('data-commercial-id')}"
                                data-client-designation-id="${e.getAttribute('data-client-designation-id')}"

                                class="update_seller_details w-[40%] my-3 create_lead_manually btn btn-sm text-white bg-[#A17AE0]">Update Seller Details</button>
                        </div>
                        <div class="content_l4 w-[100%] h-[calc(100%-50px)]">
                        
                        </div>
                    </div>
                    `

                    const ask_for_details = document.querySelector('.ask_for_details');
                    ask_for_details.addEventListener('click', async ()=>{

                        const content_l4 = document.querySelector('.content_l4');
                        content_l4.innerHTML = `
                            <div class="h-full w-full flex justify-center items-center p-2">
                                <div class="card w-96 bg-base-100 shadow-xl">
                                    <div class="card-body">
                                    <h2 class="card-title">Confirm!</h2>
                                    <p>An email will be sent to the seller asking details for MOU. Would you like to proceed?</p>
                                    <div class="card-actions justify-end">
                                        <button class="btn btn-primary confirm_send_email">Send Email</button>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        `

                        const confirm_send_email = document.querySelector('.confirm_send_email');
                        confirm_send_email.addEventListener('click',async()=>{

                            let url = '{% url "ask_for_details_email" %}';
                            data={}
                            data['client_id'] = ask_for_details.getAttribute('data-client-id');
                            data['lead_id'] = ask_for_details.getAttribute('data-lead-id');
                            let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                            if (a) {
                                poperFunction(a.status, a.message, false)
                                followUpCreation({'follow_up_type': 'follow_up_seller_details_required'})
                                content_l4.innerHTML = `
                                <div class="h-full w-full flex justify-center items-center p-2">
                                    <h2>Email Sent!</h2>
                                </div>
                                `
                            }
                        })

                    })

                    const update_seller_details = document.querySelector('.update_seller_details');
                    update_seller_details.addEventListener('click', async()=>{

                        const client_name = update_seller_details.getAttribute('data-client-name')
                        const email_id = update_seller_details.getAttribute('data-email-id')
                        const contact_number = update_seller_details.getAttribute('data-contact-number')
                        console.log('contact_number',contact_number);

                        const business_name = update_seller_details.getAttribute('data-business-name')
                        const brand_name = update_seller_details.getAttribute('data-brand-name')
                        const gst = update_seller_details.getAttribute('data-gst')
                        const seller_address = update_seller_details.getAttribute('data-seller-address')
                        const commercial_id = update_seller_details.getAttribute('data-commercial-id')
                        const client_designation = update_seller_details.getAttribute('data-client-designation-id')


                        let url = '{% url "commercials" client_id="*" lead_id="**" %}'.replaceAll('**',update_seller_details.getAttribute('data-lead-id')).replaceAll('*',update_seller_details.getAttribute('data-client-id'))
                        let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
                        let url_options = '{% url "options" table="clientdesignation" %}'
                        let b = await ftN(url_options, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

                        const content_l4 = document.querySelector('.content_l4');
                        content_l4.innerHTML = `
                            <div class="h-full w-full flex items-center flex-col overflow-y-scroll p-2">

                                <div class="w-[100%] h-10 flex my-5 ">  
                                    <p class="w-full text-center text-lg font-bold">Update Seller Details</p>
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Commercials</div>
                                    <select class="inps select_inp commercial_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Commercial" name="commercial_id">
                                        <option disabled selected value="null">select Commercials</option>
                                    </select>
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Client Name</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl  text-slate-900" placeholder="Client Name" name="client_name" value="${client_name}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Contact Number</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="Contact Number" name="contact_number" value="${contact_number}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Email Id</div>
                                    <input type="email" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="Email ID" name="email_id" value="${email_id}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Business Name</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="Business Name" name="business_name" value="${business_name}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Brand Name</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="Brand Name" name="brand_name" value="${brand_name}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">GST</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="GST" name="gst" value="${gst}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Seller Address</div>
                                    <input type="text" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" placeholder="Seller Address" name="seller_address" value="${seller_address}">
                                </div>

                                <div class="w-[100%] h-10 flex my-1 ">  
                                    <div class="flex items-center h-full w-1/4">Client Designation</div>
                                    <select class="inps select_inp client_designation_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Client Designation" name="client_designation">
                                        <option disabled selected value="null">select Client Designation</option>
                                    </select>
                                </div>

                                <button data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="update_lead w-full my-3 btn btn-success text-white">Submit</button>
                            
                            </div>
                        `

                        if (a){
                            const commercial_select = document.querySelector('.commercial_select');
                            a.data.forEach(e=>{
                                if (e.value !== 'others') {
                                    const opt = document.createElement('option');
                                    opt.value = Number(e.id)
                                    opt.innerText = e.value
                                    if (Number(e.id) === Number(commercial_id) && commercial_id !== '' ){
                                        opt.selected = true
                                    }
                                    commercial_select.append(opt)
                                }
                            })
                        }

                        if (b){
                            const client_designation_select = document.querySelector('.client_designation_select');
                            b.data.data.forEach(e=>{
                                if (e.value !== 'others') {
                                    const opt = document.createElement('option');
                                    opt.value = Number(e.id)
                                    opt.innerText = e.title
                                    console.log('client_designation',client_designation)
                                    if (Number(e.id) === Number(client_designation) && client_designation !== '' ){
                                        opt.selected = true
                                    }
                                    client_designation_select.append(opt)
                                }
                            })
                        }


                        const update_lead = document.querySelector('.update_lead');
                        update_lead.addEventListener('click',async ()=>{
                            data={}
                            const inps = document.querySelectorAll('.inps')
                            inps.forEach(e=>{
                                if (e.name === 'commercial_id' || e.name === 'client_designation' ){
                                    data[e.name] = Number(e.value)
                                } else {
                                    data[e.name] = e.value == '' ? null : e.value
                                }
                            })

                            data['lead_id'] = update_lead.getAttribute('data-lead-id')
                            data['client_id'] = update_lead.getAttribute('data-client-id')

                            let url = '{% url "update_lead" client_id="*" %}'.replaceAll('*', update_lead.getAttribute('data-client-id') )
                            let a = await ftN(url, 'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                            if(a){
                                poperFunction(a.status, a.message, false)
                            }
                            
                        })

                    })


                } closureButtonAuto()

                const closure_tab_button = document.querySelectorAll('.closure_tab_button');
                closure_tab_button.forEach(e=>{
                    e.addEventListener('click',async ()=>{
                        closure_tab_button.forEach(e=>{
                            e.classList.remove('tab-active')
                        })
                        e.classList.add('tab-active')

                        if (e.name === 'seller_details') {
                            closureButtonAuto()
                        }


                        if (e.name === 'mou') {
                            const content_l3 = document.querySelector('.content_l3');
                            content_l3.innerHTML = `
                            <div class="h-full w-full flex flex-col">
                                <div class="mou_buttons h-full w-full flex items-center justify-center flex-col px-1 ">
                                    <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="preview_mou w-[40%] my-3 create_lead_manually btn text-white bg-[#EFAA43]">Preview MOU</button>
                                    <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="email_mou w-[40%] my-3 create_lead_manually btn text-white bg-[#A17AE0]">Email MOU</button>
                                    <button data-lead-id="${e.getAttribute('data-lead-id')}" data-client-id="${e.getAttribute('data-client-id')}" class="upload_for_approval w-[40%] my-3 create_lead_manually btn text-white bg-[#67B037]">Upload For Approval</button>
                                </div>
                                <div class="content_l4 w-full h-full hidden">
                                </div>
                            </div>`

                            const preview_mou = document.querySelector('.preview_mou');
                            preview_mou.addEventListener('click', async()=>{
                                let url = '{% url "preview_mou" lead_id="*" %}'.replaceAll('*', preview_mou.getAttribute('data-lead-id'))

                                let a = await fetch(url, {'method': 'GET', 'headers': {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`} })
                                if (a) {
                                    const blobData = await a.blob()
                                    const blobUrl = URL.createObjectURL(blobData);
                                    window.open(blobUrl)
                                }

                                // Open the blob URL in a new window
                                window.open(blobUrl);
                            })

                            const email_mou = document.querySelector('.email_mou');
                            email_mou.addEventListener('click', async()=>{
                                let url = '{% url "email_mou" lead_id="*" %}'.replaceAll('*', email_mou.getAttribute('data-lead-id'))
                                let a = await ftN(url,'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
                                if (a){
                                    poperFunction(a.status, a.message, false)
                                    followUpCreation({'follow_up_type': 'follow_up_mou_pending'})
                                }
                            })

                            const upload_for_approval = document.querySelector('.upload_for_approval');
                            upload_for_approval.addEventListener('click', ()=>{

                                const mou_buttons = document.querySelector('.mou_buttons');
                                const content_l4 = document.querySelector('.content_l4');
                                mou_buttons.classList.add('hidden')
                                content_l4.classList.remove('hidden')

                                content_l4.innerHTML = `
                                    <div class="flex items-center justify-center relative h-[40px]">
                                        <img class="upload_for_approval_back_btn absolute left-[20px] w-[20px] h-[20px] cursor-pointer" src="/static/assets/images/backward_black.png">
                                        <h3 class="button_heading ml-4 text-lg font-bold ">Upload For Approval</h3>
                                    </div>

                                    <div class="h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                                        <div class="w-[100%] h-28 flex flex-col my-1 items-center ">
                                            <div class="flex justify-center items-center text-lg h-10 w-full ">Upload signed MOU for approval</div>
                                            <input type="file" class="mou_file file-input file-input-bordered w-full max-w-xs" />
                                        </div>
                                        <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="upload_mou_for_approval w-2/4 my-3 btn btn-success text-white">Submit</button>
                                    </div>
                                `

                                const upload_for_approval_back_btn = document.querySelector('.upload_for_approval_back_btn');
                                upload_for_approval_back_btn.addEventListener('click',()=>{
                                    mou_buttons.classList.remove('hidden')
                                    content_l4.classList.add('hidden')
                                })

                                const mou_file = document.querySelector('.mou_file');
                                const upload_mou_for_approval = document.querySelector('.upload_mou_for_approval');

                                mou_file.addEventListener('change',()=>{
                                    if(mou_file.files[0].type === "application/pdf"){
                                        mou_file.classList.remove('border-2')
                                        mou_file.classList.remove('border-red-700')
                                        upload_mou_for_approval.disabled = false
                                    } else {
                                        mou_file.classList.add('border-2')
                                        mou_file.classList.add('border-red-700')
                                        upload_mou_for_approval.disabled = true
                                    }
                                })

                                upload_mou_for_approval.addEventListener('click',async()=>{
                                    if(mou_file.files[0].type === "application/pdf"){
                                        let formdata = new FormData()
                                        formdata.append('file',mou_file.files[0])

                                        let url = '{% url "mou_for_approval" lead_id="*" %}'.replaceAll('*',upload_mou_for_approval.getAttribute('data-lead-id'))
                                        let a = await ftN(url, 'POST', {'Authorization': `Bearer ${getCookies().access}`}, formdata)
                                        if (a) {
                                        poperFunction(a.status,a.message, false)
                                        }
                                    } else {
                                        poperFunction(400,'this type of file can not be uploaded', false )
                                    }
                                })

                            })

                        }

                        if (e.name === 'raise_invoice') {
                            const content_l3 = document.querySelector('.content_l3');
                            content_l3.innerHTML = `
                                <div class="h-full w-full flex justify-center items-center">
                                    <div class="flex items-center flex-col">
                                        <p class="my-2">Raising Invoice will be sent to accounts department for approval</p>
                                        <button data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-2/4 my-3 btn btn-success text-white">Raise Invoice</button>    
                                    </div>
                                </div>
                            `;
                        }

                        if (e.name === 'payment') {

                            const exemptPayment = ['amazon paid', 'flipkart paid', 'foc'];
                            const content_l3 = document.querySelector('.content_l3');
                            //content_l3.innerHTML = `
                            //<div class="w-full h-full flex flex-col p-2">
                            //    <div class="h-[70px] w-full bg-slate-300 rounded-t-lg flex justify-center items-center">
                            //        <ul class="steps">
                            //            <li data-name="payment_proof" class="step">Payment Proof</li>
                            //            <li data-name="duration" class="step">Duration</li>
                            //            <li data-name="associate" class="step">Associate</li>
                            //        </ul>
                            //    </div>
                            //    <div class="content_l3_container h-[calc(100%-70px)] bg-slate-50 rounded-b-lg w-full">
                            //    </div>
                            //</div>
                            //`;
                            // const content_l3_container = content_l3.querySelector('.content_l3_container'); 

                            if (exemptPayment.includes(e.getAttribute('data-paid-by')) ){
                                content_l3.querySelectorAll('.step').forEach(e=>{
                                    if (e.getAttribute('data-name') === 'payment_proof'){
                                        e.remove();
                                    }
                                })
                                // console.log('raise invoice');
                                // serviceDuration(content_l3_container);
                                paymentProofFunc(content_l3, false);
                            } else {
                                paymentProofFunc(content_l3, true);
                            }


                            // function updateSteps(atr){
                            //     const steps = document.querySelectorAll('.step');
                            //     steps.forEach(e=>{
                            //         if (e.getAttribute('data-name') === atr){
                            //             e.classList.add('step-primary')
                            //         }
                            //     })
                            // }
                                                        
                            function paymentProofFunc(par, payment_exempt){
                                // updateSteps('payment_proof');

                                if (payment_exempt){
                                    par.innerHTML = `
                                        <div class="duration_dv h-full w-full flex flex-col justify-center items-center p-2">
                                            <div class="h-[calc(100%-50px)] w-full flex flex-col justify-center items-center">
                                                <div class="flex items-center justify-center relative h-[40px] w-full">
                                                    <h3 class="button_heading ml-4 text-lg font-bold ">Payment Proof</h3>
                                                </div>
                                                <div class="h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                                                    <div class="w-[100%] h-28 flex flex-col my-1 items-center ">
                                                        <div class="flex justify-center items-center h-10 w-full ">Upload payment proof for approval</div>
                                                        <input type="file" class="payment_proof_file file-input file-input-bordered w-full max-w-xs" />
                                                    </div>
                                                </div>
                                                    
                                                </div>
                                                <div class="w-[100%] h-[50px] flex my-1 items-center justify-center ">
                                                <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-1/4 my-3 btn btn-sm btn-success text-white">Submit</button>
                                            </div>
                                        </div>
                                    `

                                    par.querySelector('.payment_proof_file').onchange = function (e){
                                        console.log('e.target',e.target)
                                        
                                        if (e.target.files[0].type.toLocaleLowerCase().includes('image') || e.target.files[0].type === 'application/pdf' ) {
                                            e.target.classList.remove('border-2')
                                            e.target.classList.remove('border-red-700')
                                            par.querySelector('.actionBtn').disabled = false
                                        } else {
                                            par.querySelector('.actionBtn').disabled = true
                                            e.target.classList.add('border-2')
                                            e.target.classList.add('border-red-700')
                                        }
                                    }

                                    par.querySelector('.actionBtn').onclick = async function (e) {
                                        if (par.querySelector('.payment_proof_file').files[0].type.toLocaleLowerCase().includes('image') || par.querySelector('.payment_proof_file').files[0].type === 'application/pdf' ) {
                                            let formdata = new FormData()
                                            formdata.append('file', par.querySelector('.payment_proof_file').files[0])
                                            let url = '{% url "payment_proof_for_approval" lead_id="*" %}'.replaceAll('*', par.querySelector('.actionBtn').getAttribute('data-lead-id'))
                                            let a = await ftN(url,'POST', {'Authorization': `Bearer ${getCookies().access}`}, formdata)
                                            if (a){
                                                poperFunction(a.status, a.message, false)
                                                // serviceDuration(par);
                                            }
                                        } else {
                                            poperFunction(400, "This file can't be uploaded", false)
                                        }
                                    };

                                } else {
                                    // <h3 class="text-lg font-bold">Click below to raise invoice</h3>

                                    par.innerHTML = `
                                        <div class="duration_dv h-full w-full flex flex-col justify-center items-center p-2">
                                            <div class="h-[calc(100%-50px)] w-full flex flex-col justify-center items-center">
                                                <div class="flex items-center justify-center relative h-[40px] w-full">
                                                    <h3 class="button_heading ml-4 text-lg font-bold ">Raise Invoice</h3>
                                                </div>
                                                <div class="h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                                                    <ul class="list-disc">
                                                        <li class="">This service is ${e.getAttribute('data-paid-by')}</li>
                                                        <li class="">Payment Proof not required</li>
                                                        <li class="">This will be sent to account department for invoicing</li>
                                                    </ul>
                                                </div>
                                                    
                                                </div>
                                                <div class="w-[100%] h-[50px] flex my-1 items-center justify-center ">
                                                <button data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-1/4 my-3 btn btn-sm btn-success text-white">Raise Invoice</button>
                                            </div>
                                        </div>
                                    `

                                    par.querySelector('.actionBtn').onclick = async function (e) {
                                        try{
                                            let url = '{% url "raise_invoice" lead_id="*" %}'.replaceAll('*', par.querySelector('.actionBtn').getAttribute('data-lead-id'))
                                            let a = await ftN(url,'POST', {'Authorization': `Bearer ${getCookies().access}`}, '')
                                            if (a){
                                                poperFunction(a.status, a.message, a.status === 200? true : false)
                                            }
                                        } catch (e) {
                                            console.log(e)
                                        }
                    
                                    }
                                }

                            }
                                            // <select class="inps select_inp program_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Program" name="program">
                                            //     <option disabled selected value="${e.getAttribute('data-program-id')}">${e.getAttribute('data-program-name')}</option>
                                            // </select>
                            
                            // selectAssociateFunc(content_l3)


                            // content_l3.innerHTML = `
                            //     
                            //     <div class="payment_dv h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                            //         <div class="w-[100%] h-12 flex my-1 items-center ">
                            //             <div class="flex justify-center items-center h-10 w-1/4 ">Program</div>
                            //             <select class="inps select_inp program_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Program" name="program">
                            //                 <option disabled selected value="${e.getAttribute('data-program-id')}">${e.getAttribute('data-program-name')}</option>
                            //             </select>
                            //             {% comment %} <input type="file" class="mou_file file-input file-input-bordered w-full max-w-xs" /> {% endcomment %}
                            //         </div>
                            //         {% comment %} <div class="sub_program_main_dv hidden w-[100%] h-12 flex my-1 items-center ">
                            //             <div class="flex justify-center items-center h-10 w-1/4 ">Sub Program</div>
                            //             <select class="inps select_inp sub_program_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Sub Program" name="sub_program">
                            //                 <option disabled selected value="${e.getAttribute('data-sub-program-id')}">${e.getAttribute('data-sub-program-name')}</option>
                            //             </select>
                            //         </div> {% endcomment %}
                            //         <div class="payment_type_main_dv hidden w-[100%] h-12 flex my-1 items-center ">
                            //             <div class="flex justify-center items-center h-10 w-1/4 ">Payment Type</div>
                            //             <select class="inps select_inp payment_type_select my-1 border w-3/4 h-10 px-2 rounded-xl capitalize text-slate-900" placeholder="Payment Type" name="payment_type">
                            //                 <option disabled selected value="null">Select Payment Type</option>
                            //             </select>
                            //         </div>
                            //         <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="actionBtn w-2/4 my-3 btn btn-success text-white">Submit</button>
                            //     </div>
                            //     <div class="content_l4 w-full h-full hidden">
                            //     </div>
                            // `

                            // const actionBtn = document.querySelector('.actionBtn')
                            // if (e.getAttribute('data-program-name').toLocaleLowerCase() === 'regular') {
                            {% comment %} //     let url = '{% url "options" table="subscription_type" %}'.replaceAll(0, e.getAttribute('data-client-id')); {% endcomment %}
                            //     let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})
                            //     const payment_type_main_dv = document.querySelector('.payment_type_main_dv');
                            //     payment_type_main_dv.classList.remove('hidden')
                            //     actionBtn.classList.add('regular_payment_submit')
                            //     const payment_type_select = document.querySelector('.payment_type_select');
                            //     a.data.data.forEach(e=>{
                            //         const opt = document.createElement('option')
                            //         opt.value = Number(e.id)
                            //         opt.innerText = e.title
                            //         payment_type_select.append(opt)
                            //     })
                            //     payment_type_select.addEventListener('change',()=>{
                            //         if (payment_type_select.value !== null){
                            //             const regular_payment_submit = document.querySelector('.regular_payment_submit');
                            //             regular_payment_submit.disabled=false
                            //             regular_payment_submit.addEventListener('click',async()=>{
                            //                 const payment_dv = document.querySelector('.payment_dv')
                            //                 const content_l4 = document.querySelector('.content_l4')
                            //                 payment_dv.classList.add('hidden')
                            //                 content_l4.classList.remove('hidden')
                            //                 content_l4.innerHTML=`
                            //                     <div class="flex items-center justify-center relative h-[40px]">
                            //                         <img class="payment_proof_approval_back_btn absolute left-[20px] w-[20px] h-[20px] cursor-pointer" src="/static/assets/images/backward_black.png">
                            //                         <h3 class="button_heading ml-4 text-lg font-bold ">Payment Proof Approval</h3>
                            //                     </div>
                            //                     <div class="h-[calc(100%-40px)] w-full flex flex-col justify-center items-center">
                            //                         <div class="w-[100%] h-28 flex flex-col my-1 items-center ">
                            //                             <div class="flex justify-center items-center text-lg h-10 w-full ">Upload payment proof for approval</div>
                            //                             <input type="file" class="payment_proof_file file-input file-input-bordered w-full max-w-xs" />
                            //                         </div>
                            //                         <button disabled data-lead-id=${e.getAttribute('data-lead-id')} data-client-id=${e.getAttribute('data-client-id')} class="payment_proof_approval w-2/4 my-3 btn btn-success text-white">Submit</button>
                            //                     </div>`
                            //                     const payment_proof_approval_back_btn = document.querySelector('.payment_proof_approval_back_btn');
                            //                     payment_proof_approval_back_btn.addEventListener('click', ()=>{
                            //                         payment_dv.classList.remove('hidden')
                            //                         content_l4.classList.add('hidden')
                            //                     })
                            //                     const payment_proof_file = document.querySelector('.payment_proof_file');
                            //                     payment_proof_file.addEventListener('change',()=>{
                            //                         if (payment_proof_file.files[0].type.toLocaleLowerCase().includes('image') || payment_proof_file.files[0].type === 'application/pdf' ) {
                            //                             payment_proof_approval.disabled=false
                            //                             payment_proof_file.classList.remove('border-2')
                            //                             payment_proof_file.classList.remove('border-red-700')
                            //                         } else {
                            //                             payment_proof_approval.disabled=true
                            //                             payment_proof_file.classList.add('border-2')
                            //                             payment_proof_file.classList.add('border-red-700')
                            //                         }
                            //                     })
                            //                     const payment_proof_approval = document.querySelector('.payment_proof_approval');
                            //                     payment_proof_approval.addEventListener('click',async()=>{
                            //                         if (payment_proof_file.files[0].type.toLocaleLowerCase().includes('image') || payment_proof_file.files[0].type === 'application/pdf' ) {
                            //                             let formdata = new FormData()
                            //                             formdata.append('file', payment_proof_file.files[0])
                            //                             let url = '{% url "payment_proof_for_approval" lead_id="*" %}'.replaceAll(0,Number(payment_type_select.value)).replaceAll('*', payment_proof_approval.getAttribute('data-lead-id'))
                            //                             let a = await ftN(url,'POST', {'Authorization': `Bearer ${getCookies().access}`}, formdata)
                            //                             if (a){
                            //                                 poperFunction(a.status, a.message, false)
                            //                             }
                            //                         
                            //                         } else {
                            //                             poperFunction(400, "This file can't be uploaded", false)
                            //                         }
                            //                     })
                            //             })
                            //         }
                            //     })
                            // } 

                            // else if (e.getAttribute('data-program-name').toLocaleLowerCase() === 'foc') {
                            //     actionBtn.classList.add('foc_payment_submit')
                            //     actionBtn.disabled=false
                            //     actionBtn.addEventListener('click', async ()=>{
                            //         let data = {'lead_id': actionBtn.getAttribute('data-lead-id')}
                            //         let a = await ftN(url, 'POST', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                            //         if(a){
                            //             poperFunction(a.status, a.message, false)
                            //         }
                            //     })s
                            // }

                        }

                    })
                })

            })

            follow_up.addEventListener('click',()=>{
                btnEventsFun()
                followUpCreation({'follow_up_type': 'follow_up'})
                //const button_heading = document.querySelector('.button_heading');
                //button_heading.innerText="Follow Up"
    //
                //const content_l2 = document.querySelector('.content_l2')
                //content_l2.innerHTML = `
                //<div class="h-full w-full flex justify-center flex-col p-3 bg-gray-50 text-slate-900 text-xs">
    //
                //    {% csrf_token %}
    //
                //    <div class="w-[100%] h-10 flex my-1 ">  
                //        <div class="flex items-center h-full w-1/4">Date</div>
                //        <input type="date" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" name="date">
                //    </div>
                //    
                //    <div class="w-[100%] h-10 flex my-1 ">
                //        <div class="flex items-center h-full w-1/4">Time</div>
                //        <input type="time" class="inps my-1 border w-3/4 h-10 px-2 rounded-xl text-slate-900" name="time">
                //    </div>
                //    
                //    <div class="w-[100%] h-20 flex my-1 ">  
                //        <div class="flex items-center h-full w-1/4">Notes</div>
                //        <textarea class="inps my-1 p-2 border w-3/4 h-full px-2 rounded-xl text-slate-900 resize-none" name="notes"></textarea>
                //    </div>
    //
                //    <button data-lead-id=${e.getAttribute('data-lead-id')} class="follow_up_submit w-full my-3 btn btn-success text-white">Submit</button>
                //</div>
                //`
    //
                //const follow_up_submit  = document.querySelector('.follow_up_submit');
                //follow_up_submit.addEventListener('click',async()=>{
                //    let data={}
                //    let inps = document.querySelectorAll('.inps')
                //    inps.forEach(e=>{
                //        data[e.name] = e.value
                //    })
                //    data['client_id'] = follow_up_submit.getAttribute('data-client-id')
                //    data['lead_id'] = follow_up_submit.getAttribute('data-lead-id')
                //    
    //
                //    let url = '{% url "create_followup" %}'
                //    let a = await ftN(url,'POST',{'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                //    if (a){
                //        poperFunction(a.status, a.message, false)
                //    }
    //
                //})
            })

            not_interested.addEventListener('click',async()=>{

                let url = '{% url "options" table="notinterested" %}'
                let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

                btnEventsFun()
                const button_heading = document.querySelector('.button_heading');
                button_heading.innerText="Not Interested Reasons"
                reasonSelection(not_interested.getAttribute('data-lead-id'),not_interested.getAttribute('data-client-id'), 'not_interested')
                
                const not_interested_select = document.querySelector('.not_interested_select');
                if (a){
                    a.data.data.forEach(e=>{
                        const opt = document.createElement('option');
                        opt.value = Number(e.id)
                        opt.innerText = e.title
                        not_interested_select.append(opt)
                    })
                }

                const not_interested_submit = document.querySelector('.not_interested_submit');
                not_interested_submit.addEventListener('click',async()=>{
                    data={}
                    data['status_id'] = not_interested_select.value
                    data['lead_id'] = not_interested_submit.getAttribute('data-lead-id')
                    data['client_id'] = not_interested_submit.getAttribute('data-client-id')

                    let url = '{% url "reason_submit" table="not_interested" %}'
                    let a = await ftN(url,'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){
                        poperFunction(a.status, a.message, false)
                    }
                })

            })

            unresponsive.addEventListener('click',async()=>{
                let url = '{% url "options" table="unresponsive" %}'
                let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`})

                btnEventsFun()
                const button_heading = document.querySelector('.button_heading');
                button_heading.innerText="Unresponsive Reasons"
                reasonSelection(unresponsive.getAttribute('data-lead-id'),unresponsive.getAttribute('data-client-id'), 'unresponsive')


                const unresponsive_select = document.querySelector('.unresponsive_select');
                if (a){
                    a.data.data.forEach(e=>{
                        const opt = document.createElement('option');
                        opt.value = Number(e.id)
                        opt.innerText = e.title
                        unresponsive_select.append(opt)
                    })
                }

                const unresponsive_submit = document.querySelector('.unresponsive_submit');
                unresponsive_submit.addEventListener('click',async()=>{
                    data={}
                    data['status_id'] = unresponsive_select.value
                    data['lead_id'] = unresponsive_submit.getAttribute('data-lead-id')
                    data['client_id'] = unresponsive_submit.getAttribute('data-client-id')

                    let url = '{% url "reason_submit" table="unresponsive" %}'
                    let a = await ftN(url,'PUT', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, JSON.stringify(data))
                    if (a){
                        console.log(a.data)
                        poperFunction(a.status, a.message, a.data[0].lead_status==='dead_lead'?true:false)
                        followUpCreation({'follow_up_type': 'follow_up_unresponsive'})
                    }
                })

            })

    }

    })
})

{% comment %} {% endif %} {% endcomment %}


} mainEditFunction()


const lead_search_selection_submit = document.querySelector('.lead_search_selection_submit');
lead_search_selection_submit.addEventListener('click', async ()=>{

    const lead_search = document.querySelector('.lead_search');
    const lead_search_selection = document.querySelector('.lead_search_selection');

    let url = '{% url "lead_search" attribute="**" data="*" %}'.replaceAll('**', lead_search_selection.value).replaceAll('*', lead_search.value.trim().replaceAll(' ','_'))
    let a = await ftN(url, 'GET', {'Content-Type': 'application/json', 'Authorization': `Bearer ${getCookies().access}`}, '')
    if (a){
        const main_table = document.querySelector('.main_table')
        main_table.innerHTML = ''
        a.data.forEach(e=>{

            console.log(e.marketplace)

            const tr = document.createElement('tr')
            tr.innerHTML = `

            <tr class="border-b border-slate-200 shadow-sm hover:shadow-md ${
                        e.status === 'yet_to_contact' 
                            ? e.deadline < 0 
                                ? 'bg-red-800 text-white' 
                                :  e.deadline <= 1 
                                    ? 'bg-red-600 text-white'
                                    : ''     
                            : '' }   rounded-xl">
                
                <td class="px-[3px] py-1 capitalize"><input class="bulk_select" type="checkbox" data-lead-id="${e.lead_id}" ></td>
                <td class="capitalize">{% if d.hot_lead %}<div class="h-2 w-2 rounded-full bg-yellow-600"></div>{% endif %}</td>
                <td class="px-[3px] py-1 capitalize">${e.lead_id}</td>
                <td class="px-[3px] py-1 capitalize">${e.client_name}</td>
                <td class="px-[3px] py-1 capitalize">${e.contact_number}</td>
                <td class="px-[3px] py-1 capitalize">${e.email_id}</td>    
                <td class="px-[3px] py-1 capitalize">${e.marketplace.value}</td>
                <td class="px-[3px] py-1 capitalize">${e.service.value}</td>
                <td class="px-[3px] py-1 capitalize">${e.associate.name }</td>
                <td class="px-[3px] py-1 capitalize">${e.status.value}</td>
                <td class="px-[3px] py-1">
                    <div class="w-full h-full flex">
                        <div data-lead-id="${e.lead_id}"
                            data-client-id="${e.client_id}"
                            data-request-id="${e.request_id}"
                            data-provider-id="${e.provider_id}"
                            data-requester-id="${e.requester_id}"
                            data-client-name="${e.client_name}"
                            data-email-id="${e.email_id}"
                            data-contact-number="${e.contact_number}"
                            data-requester-location="${e.requester_location}"
                            data-business-name="${e.business_name}"
                            data-requester-sell-in-country="${e.requester_sell_in_country}"
                            data-gst="${e.gst}"
                            data-service-request-type="${e.service_request_type}"
                            data-upload-date="${e.upload_date.year}-${e.upload_date.month}-${e.upload_date.day}"
                            data-seller-address="${e.seller_address}"
                            data-lead-owner-id="${e.lead_owner.id}"
                            data-lead-owner="${e.lead_owner.name}"
                            data-client-turnover-id="${e.client_turnover.id}"
                            data-client-turnover="${e.client_turnover}"
                            data-status="${status}"
                            data-program-id="${e.program.id}"
                            data-program="${e.program.value}"
                            data-marketplace-id="${e.marketplace.id}"
                            data-marketplace="${e.marketplace.value}"
                            data-service-id="${e.service.id}"
                            data-service="${e.service.value}"
                            data-segment-id="${e.segment.id}"
                            data-segment="${e.segment.value}"
                            data-payment-model-id="${e.payment_model.id}"
                            data-payment-model="${e.payment_model.value}"
                            data-payment-terms-id="${e.payment_terms.id}"
                            data-payment-terms="${e.payment_terms.value}"
                            data-mou-required="${e.mou_required}"
                            data-paid-by-id="${e.paid_by.id}"
                            data-paid-by="${e.paid_by.value}"
                            data-comments="${e.comments}"
                            data-associate-id="${e.associate.id}
                            data-associate="${e.associate}
                            
                            data-business-category="${e.business_category.id}"
                            {% comment %} data-business-category-id="{{e.business_category.id}}" {% endcomment %}
                            data-hot-lead=${e.hot_lead}
                        
                            data-tip="View/Edit"
                            class='view_edit tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-green-600 rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_view_white.png" %}">
                        </div>
                        <div data-lead-id="${e.lead_id}"
                            data-client-id="${e.client_id}"
                            data-client-name="${e.client_name}"
                            data-email-id="${e.email_id}"
                            data-contact-number="${e.contact_number}"
                            data-business-name="${e.business_name}"
                            data-brand-name="${e.brand_name}"
                            data-gst="${e.gst}"
                            data-seller-address="${e.seller_address}"
                            data-client-designation-id="${e.client_designation_id}"
                            data-program-id="${e.program.id}"
                            data-program="${e.program.value}"
                            data-marketplace-id="${e.marketplace.id}"
                            data-marketplace="${e.marketplace.value}"
                            data-service-id="${e.service.id}"
                            data-service="${e.service.value}"
                            data-segment-id="${e.segment.id}"
                            data-segment="${e.segment.value}"
                            data-payment-model-id="${e.payment_model.id}"
                            data-payment-model="${e.payment_model.value}"
                            data-payment-terms-id="${e.payment_terms.id}"
                            data-payment-terms="${e.payment_terms.value}"
                            data-mou-required="${e.mou_required}"
                            data-paid-by-id="${e.paid_by.id}"
                            data-paid-by="${e.paid_by.value}"
                            data-comments="${e.comments}"
                            data-status="${e.status.value}"
                            data-commercial-approval-type="${e.commercial_approval.commercial}"
                            data-commercial-approval-status="${e.commercial_approval.status}"
                            data-commercial-id="${e.commercial}"

                            data-tip="Initiate Call"
                            class='initiate_call tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#46A5C6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_initiate_call_white.png" %}">
                            </div>
                            
                        <div 
                            data-lead-id="${e.lead_id}"
                            data-client-id="${e.client_id}"
                            data-tip="Add Service"
                            class='add_service tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#A258C5] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_add_service_white.png" %}">
                        </div>
                        <div 
                            data-lead-id="${e.lead_id}"
                            data-client-id="${e.client_id}"
                            data-lead-id="${e.lead_id}"
                            data-selected-status-id="${e.status.id}"
                            data-tip="Status Update"
                            class='status_update tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#2F3642] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_status_update_white.png" %}">
                        </div>
                        <div 
                            data-lead-id="${e.lead_id}"
                            data-client-id="${e.client_id}"
                            data-lead-id="${e.lead_id}"
                            data-selected-status-id="${e.status.id}"
                            data-tip="Follow Up History"
                            class='follow_up_history tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#CA02B6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_followup_history_white.png" %}">
                        </div>
                        {% if request.user|role_validity:'business_development_team_lead' or request.user|role_validity:'super_admin' or request.user|role_validity:'admin' or request.user.is_admin %}    
                            <div 
                                data-lead-id="${e.lead_id}"
                                data-client-id="${e.client_id}"
                                data-tip="All Services"
                                class='all_services tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#3790B6] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_all_services_white.png" %}">
                            </div>
                            
                            <div 
                                data-lead-id="${e.lead_id}"
                                data-client-id="${e.client_id}"
                                data-tip="Assign Associate"
                                class='assign_associate tooltip-open tool_tip cursor-pointer h-6 w-6 flex justify-center items-center bg-[#8E4AD2] rounded-lg mx-1 p-1'><img src="{% static "assets/images/action_assign_associate_white.png" %}">
                            </div>
                        {% endif %}
                    </td>
                </tr>

            `
            main_table.append(tr)
        })

        mainEditFunction()

    } else {
        poperFunction(a.status,a.message, a.status===200?true:false)
    }
})

const clear_button = document.querySelector('.clear_button');
clear_button.addEventListener('click',()=>{
    const lead_search = document.querySelector('.lead_search');
    window.location.reload()
})







</script>

<script src="{% static "assets/js/tooltip.js" %}"></script>

{% endblock  %}